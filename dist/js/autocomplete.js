"use strict";var _createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),_get=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,n,o)}if("value"in i)return i.value;var r=i.get;return void 0!==r?r.call(o):void 0};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}!function(l){var t={data:{},limit:1/0,onAutocomplete:null,minLength:1,sortFunction:function(e,t,n){return e.indexOf(n)-t.indexOf(n)}},e=function(e){function i(e,t){_classCallCheck(this,i);var n=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,i,e,t));return(n.el.M_Autocomplete=n).options=l.extend({},i.defaults,t),n.isOpen=!1,n.count=0,n.activeIndex=-1,n.oldVal,n.$inputField=n.$el.closest(".input-field"),n.$active=l(),n._setupDropdown(),n._setupEventHandlers(),n}return _inherits(i,Component),_createClass(i,[{key:"destroy",value:function(){this._removeEventHandlers(),this._removeDropdown(),this.el.M_Autocomplete=void 0}},{key:"_setupEventHandlers",value:function(){this._handleInputBlurBound=this._handleInputBlur.bind(this),this._handleInputKeyupAndFocusBound=this._handleInputKeyupAndFocus.bind(this),this._handleInputKeydownBound=this._handleInputKeydown.bind(this),this._handleContainerMousedownAndTouchstartBound=this._handleContainerMousedownAndTouchstart.bind(this),this.el.addEventListener("blur",this._handleInputBlurBound),this.el.addEventListener("keyup",this._handleInputKeyupAndFocusBound),this.el.addEventListener("focus",this._handleInputKeyupAndFocusBound),this.el.addEventListener("keydown",this._handleInputKeydownBound),this.container.addEventListener("mousedown",this._handleContainerMousedownAndTouchstartBound),void 0!==window.ontouchstart&&this.container.addEventListener("touchstart",this._handleContainerMousedownAndTouchstartBound)}},{key:"_removeEventHandlers",value:function(){this.el.removeEventListener("blur",this._handleInputBlurBound),this.el.removeEventListener("keyup",this._handleInputKeyupAndFocusBound),this.el.removeEventListener("focus",this._handleInputKeyupAndFocusBound),this.el.removeEventListener("keydown",this._handleInputKeydownBound),this.container.removeEventListener("mousedown",this._handleContainerMousedownAndTouchstartBound),void 0!==window.ontouchstart&&this.container.removeEventListener("touchstart",this._handleContainerMousedownAndTouchstartBound)}},{key:"_setupDropdown",value:function(){this.container=document.createElement("ul"),this.container.id="autocomplete-options-"+M.guid(),l(this.container).addClass("autocomplete-content dropdown-content"),this.$inputField.append(this.container),this.el.setAttribute("data-target",this.container.id),this.dropdown=M.Dropdown.init(this.el,{autoFocus:!1,closeOnClick:!1,coverTrigger:!1}),this.el.removeEventListener("click",this.dropdown._handleClickBound)}},{key:"_removeDropdown",value:function(){this.container.parentNode.removeChild(this.container)}},{key:"_handleInputBlur",value:function(){this.dropdown.close(),this._resetAutocomplete()}},{key:"_handleInputKeyupAndFocus",value:function(e){var t=this;"keyup"===e.type&&(i._keydown=!1),this.count=0;var n=this.el.value.toLowerCase();13!==e.keyCode&&38!==e.keyCode&&40!==e.keyCode&&(this.oldVal!==n&&(this._resetAutocomplete(),n.length>=this.options.minLength&&(this.isOpen=!0,this._renderDropdown(this.options.data,n)),this.dropdown.isOpen?this.dropdown.recalculateDimensions():setTimeout(function(){t.dropdown.open()},100)),this.oldVal=n)}},{key:"_handleInputKeydown",value:function(e){i._keydown=!0;var t=e.keyCode,n=void 0,o=l(this.container).children("li").length;13===t&&0<=this.activeIndex?(n=l(this.container).children("li").eq(this.activeIndex)).length&&(this.selectOption(n),e.preventDefault()):38!==t&&40!==t||(e.preventDefault(),38===t&&0<this.activeIndex&&this.activeIndex--,40===t&&this.activeIndex<o-1&&this.activeIndex++,this.$active.removeClass("active"),0<=this.activeIndex&&(this.$active=l(this.container).children("li").eq(this.activeIndex),this.$active.addClass("active")))}},{key:"_handleContainerMousedownAndTouchstart",value:function(e){var t=l(e.target).closest("li");this.selectOption(t)}},{key:"_highlight",value:function(e,t){var n=t.find("img"),o=t.text().toLowerCase().indexOf(""+e.toLowerCase()),i=o+e.length-1,s=t.text().slice(0,o),r=t.text().slice(o,i+1),a=t.text().slice(i+1);t.html("<span>"+s+"<span class='highlight'>"+r+"</span>"+a+"</span>"),n.length&&t.prepend(n)}},{key:"_resetCurrentElement",value:function(){this.activeIndex=-1,this.$active.removeClass("active")}},{key:"_resetAutocomplete",value:function(){l(this.container).empty(),this._resetCurrentElement(),this.oldVal=null,this.isOpen=!1}},{key:"selectOption",value:function(e){var t=e.text().trim();this.el.value=t,this.$el.trigger("change"),this._resetAutocomplete(),this.dropdown.close(),"function"==typeof this.options.onAutocomplete&&this.options.onAutocomplete.call(this,t)}},{key:"_renderDropdown",value:function(e,n){var o=this;this._resetAutocomplete();var t=[];for(var i in e)if(e.hasOwnProperty(i)&&-1!==i.toLowerCase().indexOf(n)){if(this.count>=this.options.limit)break;var s={data:e[i],key:i};t.push(s),this.count++}t.sort(function(e,t){return o.options.sortFunction(e.key.toLowerCase(),t.key.toLowerCase(),n.toLowerCase())});for(var r=0;r<t.length;r++){var a=t[r],u=l("<li></li>");a.data?u.append('<img src="'+a.data+'" class="right circle"><span>'+a.key+"</span>"):u.append("<span>"+a.key+"</span>"),l(this.container).append(u),this._highlight(n,u)}}},{key:"updateData",value:function(e){var t=this.el.value.toLowerCase();this.options.data=e,this.isOpen&&this._renderDropdown(e,t)}}],[{key:"init",value:function(e,t){return _get(i.__proto__||Object.getPrototypeOf(i),"init",this).call(this,this,e,t)}},{key:"getInstance",value:function(e){return(e.jquery?e[0]:e).M_Autocomplete}},{key:"defaults",get:function(){return t}}]),i}();e._keydown=!1,M.Autocomplete=e,M.jQueryLoaded&&M.initializeJqueryWrapper(e,"autocomplete","M_Autocomplete")}(cash);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dG9jb21wbGV0ZS5qcyJdLCJuYW1lcyI6WyIkIiwiX2RlZmF1bHRzIiwiZGF0YSIsImxpbWl0IiwiSW5maW5pdHkiLCJvbkF1dG9jb21wbGV0ZSIsIm1pbkxlbmd0aCIsInNvcnRGdW5jdGlvbiIsImEiLCJiIiwiaW5wdXRTdHJpbmciLCJpbmRleE9mIiwiX0NvbXBvbmVudCIsIkF1dG9jb21wbGV0ZSIsImVsIiwib3B0aW9ucyIsIl9jbGFzc0NhbGxDaGVjayIsInRoaXMiLCJfdGhpcyIsIl9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIiwiX19wcm90b19fIiwiT2JqZWN0IiwiZ2V0UHJvdG90eXBlT2YiLCJjYWxsIiwiTV9BdXRvY29tcGxldGUiLCJleHRlbmQiLCJkZWZhdWx0cyIsImlzT3BlbiIsImNvdW50IiwiYWN0aXZlSW5kZXgiLCJvbGRWYWwiLCIkaW5wdXRGaWVsZCIsIiRlbCIsImNsb3Nlc3QiLCIkYWN0aXZlIiwiX3NldHVwRHJvcGRvd24iLCJfc2V0dXBFdmVudEhhbmRsZXJzIiwiX2luaGVyaXRzIiwiQ29tcG9uZW50IiwiX2NyZWF0ZUNsYXNzIiwia2V5IiwidmFsdWUiLCJfcmVtb3ZlRXZlbnRIYW5kbGVycyIsIl9yZW1vdmVEcm9wZG93biIsInVuZGVmaW5lZCIsIl9oYW5kbGVJbnB1dEJsdXJCb3VuZCIsIl9oYW5kbGVJbnB1dEJsdXIiLCJiaW5kIiwiX2hhbmRsZUlucHV0S2V5dXBBbmRGb2N1c0JvdW5kIiwiX2hhbmRsZUlucHV0S2V5dXBBbmRGb2N1cyIsIl9oYW5kbGVJbnB1dEtleWRvd25Cb3VuZCIsIl9oYW5kbGVJbnB1dEtleWRvd24iLCJfaGFuZGxlQ29udGFpbmVyTW91c2Vkb3duQW5kVG91Y2hzdGFydEJvdW5kIiwiX2hhbmRsZUNvbnRhaW5lck1vdXNlZG93bkFuZFRvdWNoc3RhcnQiLCJhZGRFdmVudExpc3RlbmVyIiwiY29udGFpbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIm9udG91Y2hzdGFydCIsIndpbmRvdyIsIk0iLCJndWlkIiwiYWRkQ2xhc3MiLCJzZXRBdHRyaWJ1dGUiLCJpZCIsImRyb3Bkb3duIiwiRHJvcGRvd24iLCJpbml0IiwiYXV0b0ZvY3VzIiwiY2xvc2VPbkNsaWNrIiwiY292ZXJUcmlnZ2VyIiwiX2hhbmRsZUNsaWNrQm91bmQiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJjbG9zZSIsIl9yZXNldEF1dG9jb21wbGV0ZSIsImUiLCJfdGhpczIiLCJ0eXBlIiwiX2tleWRvd24iLCJ2YWwiLCJ0b0xvd2VyQ2FzZSIsImtleUNvZGUiLCJsZW5ndGgiLCJfcmVuZGVyRHJvcGRvd24iLCJyZWNhbGN1bGF0ZURpbWVuc2lvbnMiLCJzZXRUaW1lb3V0IiwibGlFbGVtZW50IiwiY2hpbGRyZW4iLCJlcSIsInNlbGVjdE9wdGlvbiIsInByZXZlbnREZWZhdWx0IiwibnVtSXRlbXMiLCIkYXV0b2NvbXBsZXRlT3B0aW9uIiwidGFyZ2V0Iiwic3RyaW5nIiwiaW1nIiwibWF0Y2hTdGFydCIsIm1hdGNoRW5kIiwiYmVmb3JlTWF0Y2giLCJ0ZXh0Iiwic2xpY2UiLCJtYXRjaFRleHQiLCJyZW1vdmVDbGFzcyIsImFmdGVyTWF0Y2giLCJodG1sIiwicHJlcGVuZCIsImVtcHR5IiwiX3Jlc2V0Q3VycmVudEVsZW1lbnQiLCJfdGhpczMiLCJtYXRjaGluZ0RhdGEiLCJoYXNPd25Qcm9wZXJ0eSIsImVudHJ5IiwicHVzaCIsInNvcnQiLCJpIiwiYXBwZW5kIiwiX2hpZ2hsaWdodCIsImVscyIsIl9nZXQiLCJnZXQiLCJqUXVlcnlMb2FkZWQiLCJpbml0aWFsaXplSnF1ZXJ5V3JhcHBlciIsInNvcnRGdW5jdGlvbkJvdW5kIl0sIm1hcHBpbmdzIjoiNG5DQUFDLFNBQVVBLEdBR1QsSUFBSUMsRUFBWSxDQUNkQyxLQUFNLEdBQ05DLE1BQU9DLEVBQUFBLEVBQ1BDLGVBQWdCLEtBQ2hCQyxVQUFXLEVBQ1hDLGFBQWMsU0FBVUMsRUFBR0MsRUFBR0MsR0FDNUIsT0FBT0YsRUFBRUcsUUFBUUQsR0FBZUQs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LEVBQUE2RSxNQTVURSxDQUFBLENBQUF2QyxJQUFBLE9BQUFDLE1BQUEsU0E0REU0RSxFQUFLdEcsR0FoQmYsT0FBQXVHLEtBQUF6RyxFQUFBTyxXQUFBQyxPQUFBQyxlQUFBVCxHQUFBLE9BQUFJLE1BQUFNLEtBQUFOLEtBQUFBLEtBQUFvRyxFQUFBdEcsS0E1Q1EsQ0FBQXlCLElBQUEsY0FBQUMsTUFBQSxTQWtET3pDLEdBbUJmLE9BbEJLbUMsRUFBQUEsT0FBTHJCLEVBQUEsR0FBQUEsR0FrQmVVLGlCQXJFUCxDQUFBZ0IsSUFBQSxXQUFBK0UsSUFBQSxXQXlEUixPQUFPdEgsTUF6RENZLEVBQUEsR0FxVUpBLEVBQUFpRSxVQUFBLEVBRUhuQixFQUFBOUMsYUFBQUEsRUFFRDhDLEVBQUE2RCxjQUNBN0QsRUFBQThELHdCQUFJQyxFQUFBQSxlQUFvQixrQkExVTdCLENBNlVLYiIsImZpbGUiOiJhdXRvY29tcGxldGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGxldCBfZGVmYXVsdHMgPSB7XG4gICAgZGF0YToge30sIC8vIEF1dG9jb21wbGV0ZSBkYXRhIHNldFxuICAgIGxpbWl0OiBJbmZpbml0eSwgLy8gTGltaXQgb2YgcmVzdWx0cyB0aGUgYXV0b2NvbXBsZXRlIHNob3dzXG4gICAgb25BdXRvY29tcGxldGU6IG51bGwsIC8vIENhbGxiYWNrIGZvciB3aGVuIGF1dG9jb21wbGV0ZWRcbiAgICBtaW5MZW5ndGg6IDEsIC8vIE1pbiBjaGFyYWN0ZXJzIGJlZm9yZSBhdXRvY29tcGxldGUgc3RhcnRzXG4gICAgc29ydEZ1bmN0aW9uOiBmdW5jdGlvbiAoYSwgYiwgaW5wdXRTdHJpbmcpIHsgLy8gU29ydCBmdW5jdGlvbiBmb3Igc29ydGluZyBhdXRvY29tcGxldGUgcmVzdWx0c1xuICAgICAgcmV0dXJuIGEuaW5kZXhPZihpbnB1dFN0cmluZykgLSBiLmluZGV4T2YoaW5wdXRTdHJpbmcpO1xuICAgIH1cbiAgfTtcblxuXG4gIC8qKlxuICAgKiBAY2xhc3NcbiAgICpcbiAgICovXG4gIGNsYXNzIEF1dG9jb21wbGV0ZSBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0IEF1dG9jb21wbGV0ZSBpbnN0YW5jZVxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB7RWxlbWVudH0gZWxcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGVsLCBvcHRpb25zKSB7XG4gICAgICBzdXBlcihBdXRvY29tcGxldGUsIGVsLCBvcHRpb25zKTtcblxuICAgICAgdGhpcy5lbC5NX0F1dG9jb21wbGV0ZSA9IHRoaXM7XG5cbiAgICAgIC8qKlxuICAgICAgICogT3B0aW9ucyBmb3IgdGhlIGF1dG9jb21wbGV0ZVxuICAgICAgICogQG1lbWJlciBBdXRvY29tcGxldGUjb3B0aW9uc1xuICAgICAgICogQHByb3Age051bWJlcn0gZHVyYXRpb25cbiAgICAgICAqIEBwcm9wIHtOdW1iZXJ9IGRpc3RcbiAgICAgICAqIEBwcm9wIHtudW1iZXJ9IHNoaWZ0XG4gICAgICAgKiBAcHJvcCB7bnVtYmVyfSBwYWRkaW5nXG4gICAgICAgKiBAcHJvcCB7Qm9vbGVhbn0gZnVsbFdpZHRoXG4gICAgICAgKiBAcHJvcCB7Qm9vbGVhbn0gaW5kaWNhdG9yc1xuICAgICAgICogQHByb3Age0Jvb2xlYW59IG5vV3JhcFxuICAgICAgICogQHByb3Age0Z1bmN0aW9ufSBvbkN5Y2xlVG9cbiAgICAgICAqL1xuICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIEF1dG9jb21wbGV0ZS5kZWZhdWx0cywgb3B0aW9ucyk7XG5cbiAgICAgIC8vIFNldHVwXG4gICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuICAgICAgdGhpcy5jb3VudCA9IDA7XG4gICAgICB0aGlzLmFjdGl2ZUluZGV4ID0gLTE7XG4gICAgICB0aGlzLm9sZFZhbDtcbiAgICAgIHRoaXMuJGlucHV0RmllbGQgPSB0aGlzLiRlbC5jbG9zZXN0KCcuaW5wdXQtZmllbGQnKTtcbiAgICAgIHRoaXMuJGFjdGl2ZSA9ICQoKTtcbiAgICAgIHRoaXMuX3NldHVwRHJvcGRvd24oKTtcblxuICAgICAgdGhpcy5fc2V0dXBFdmVudEhhbmRsZXJzKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBkZWZhdWx0cygpIHtcbiAgICAgIHJldHVybiBfZGVmYXVsdHM7XG4gICAgfVxuXG4gICAgc3RhdGljIGluaXQoZWxzLCBvcHRpb25zKSB7XG4gICAgICByZXR1cm4gc3VwZXIuaW5pdCh0aGlzLCBlbHMsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBJbnN0YW5jZVxuICAgICAqL1xuICAgIHN0YXRpYyBnZXRJbnN0YW5jZShlbCkge1xuICAgICAgbGV0IGRvbUVsZW0gPSAhIWVsLmpxdWVyeSA/IGVsWzBdIDogZWw7XG4gICAgICByZXR1cm4gZG9tRWxlbS5NX0F1dG9jb21wbGV0ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZWFyZG93biBjb21wb25lbnRcbiAgICAgKi9cbiAgICBkZXN0cm95KCkge1xuICAgICAgdGhpcy5fcmVtb3ZlRXZlbnRIYW5kbGVycygpO1xuICAgICAgdGhpcy5fcmVtb3ZlRHJvcGRvd24oKTtcbiAgICAgIHRoaXMuZWwuTV9BdXRvY29tcGxldGUgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0dXAgRXZlbnQgSGFuZGxlcnNcbiAgICAgKi9cbiAgICBfc2V0dXBFdmVudEhhbmRsZXJzKCkge1xuICAgICAgdGhpcy5faGFuZGxlSW5wdXRCbHVyQm91bmQgPSB0aGlzLl9oYW5kbGVJbnB1dEJsdXIuYmluZCh0aGlzKTtcbiAgICAgIHRoaXMuX2hhbmRsZUlucHV0S2V5dXBBbmRGb2N1c0JvdW5kID0gdGhpcy5faGFuZGxlSW5wdXRLZXl1cEFuZEZvY3VzLmJpbmQodGhpcyk7XG4gICAgICB0aGlzLl9oYW5kbGVJbnB1dEtleWRvd25Cb3VuZCA9IHRoaXMuX2hhbmRsZUlucHV0S2V5ZG93bi5iaW5kKHRoaXMpO1xuICAgICAgdGhpcy5faGFuZGxlQ29udGFpbmVyTW91c2Vkb3duQW5kVG91Y2hzdGFydEJvdW5kID0gdGhpcy5faGFuZGxlQ29udGFpbmVyTW91c2Vkb3duQW5kVG91Y2hzdGFydC5iaW5kKHRoaXMpO1xuXG4gICAgICB0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9oYW5kbGVJbnB1dEJsdXJCb3VuZCk7XG4gICAgICB0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5faGFuZGxlSW5wdXRLZXl1cEFuZEZvY3VzQm91bmQpO1xuICAgICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX2hhbmRsZUlucHV0S2V5dXBBbmRGb2N1c0JvdW5kKTtcbiAgICAgIHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX2hhbmRsZUlucHV0S2V5ZG93bkJvdW5kKTtcbiAgICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuX2hhbmRsZUNvbnRhaW5lck1vdXNlZG93bkFuZFRvdWNoc3RhcnRCb3VuZCk7XG5cbiAgICAgIGlmICh0eXBlb2Ygd2luZG93Lm9udG91Y2hzdGFydCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMuX2hhbmRsZUNvbnRhaW5lck1vdXNlZG93bkFuZFRvdWNoc3RhcnRCb3VuZCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIEV2ZW50IEhhbmRsZXJzXG4gICAgICovXG4gICAgX3JlbW92ZUV2ZW50SGFuZGxlcnMoKSB7XG4gICAgICB0aGlzLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9oYW5kbGVJbnB1dEJsdXJCb3VuZCk7XG4gICAgICB0aGlzLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5faGFuZGxlSW5wdXRLZXl1cEFuZEZvY3VzQm91bmQpO1xuICAgICAgdGhpcy5lbC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX2hhbmRsZUlucHV0S2V5dXBBbmRGb2N1c0JvdW5kKTtcbiAgICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX2hhbmRsZUlucHV0S2V5ZG93bkJvdW5kKTtcbiAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuX2hhbmRsZUNvbnRhaW5lck1vdXNlZG93bkFuZFRvdWNoc3RhcnRCb3VuZCk7XG5cbiAgICAgIGlmICh0eXBlb2Ygd2luZG93Lm9udG91Y2hzdGFydCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMuX2hhbmRsZUNvbnRhaW5lck1vdXNlZG93bkFuZFRvdWNoc3RhcnRCb3VuZCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0dXAgZHJvcGRvd25cbiAgICAgKi9cbiAgICBfc2V0dXBEcm9wZG93bigpIHtcbiAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTtcbiAgICAgIHRoaXMuY29udGFpbmVyLmlkID0gYGF1dG9jb21wbGV0ZS1vcHRpb25zLSR7TS5ndWlkKCl9YDtcbiAgICAgICQodGhpcy5jb250YWluZXIpLmFkZENsYXNzKCdhdXRvY29tcGxldGUtY29udGVudCBkcm9wZG93bi1jb250ZW50Jyk7XG4gICAgICB0aGlzLiRpbnB1dEZpZWxkLmFwcGVuZCh0aGlzLmNvbnRhaW5lcik7XG4gICAgICB0aGlzLmVsLnNldEF0dHJpYnV0ZSgnZGF0YS10YXJnZXQnLCB0aGlzLmNvbnRhaW5lci5pZCk7XG5cbiAgICAgIHRoaXMuZHJvcGRvd24gPSBNLkRyb3Bkb3duLmluaXQodGhpcy5lbCwge1xuICAgICAgICBhdXRvRm9jdXM6IGZhbHNlLFxuICAgICAgICBjbG9zZU9uQ2xpY2s6IGZhbHNlLFxuICAgICAgICBjb3ZlclRyaWdnZXI6IGZhbHNlLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNrZXRjaHkgcmVtb3ZhbCBvZiBkcm9wZG93biBjbGljayBoYW5kbGVyXG4gICAgICB0aGlzLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5kcm9wZG93bi5faGFuZGxlQ2xpY2tCb3VuZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGRyb3Bkb3duXG4gICAgICovXG4gICAgX3JlbW92ZURyb3Bkb3duKCkge1xuICAgICAgdGhpcy5jb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmNvbnRhaW5lcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIElucHV0IEJsdXJcbiAgICAgKi9cbiAgICBfaGFuZGxlSW5wdXRCbHVyKCkge1xuICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpO1xuICAgICAgdGhpcy5fcmVzZXRBdXRvY29tcGxldGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgSW5wdXQgS2V5dXAgYW5kIEZvY3VzXG4gICAgICogQHBhcmFtIHtFdmVudH0gZVxuICAgICAqL1xuICAgIF9oYW5kbGVJbnB1dEtleXVwQW5kRm9jdXMoZSkge1xuICAgICAgaWYgKGUudHlwZSA9PT0gJ2tleXVwJykge1xuICAgICAgICBBdXRvY29tcGxldGUuX2tleWRvd24gPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jb3VudCA9IDA7XG4gICAgICBsZXQgdmFsID0gdGhpcy5lbC52YWx1ZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAvLyBEb24ndCBjYXB0dXJlIGVudGVyIG9yIGFycm93IGtleSB1c2FnZS5cbiAgICAgIGlmIChlLmtleUNvZGUgPT09IDEzIHx8XG4gICAgICAgIGUua2V5Q29kZSA9PT0gMzggfHxcbiAgICAgICAgZS5rZXlDb2RlID09PSA0MCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHRoZSBpbnB1dCBpc24ndCBlbXB0eVxuICAgICAgaWYgKHRoaXMub2xkVmFsICE9PSB2YWwpIHtcbiAgICAgICAgdGhpcy5fcmVzZXRBdXRvY29tcGxldGUoKTtcblxuICAgICAgICBpZiAodmFsLmxlbmd0aCA+PSB0aGlzLm9wdGlvbnMubWluTGVuZ3RoKSB7XG4gICAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xuICAgICAgICAgIHRoaXMuX3JlbmRlckRyb3Bkb3duKHRoaXMub3B0aW9ucy5kYXRhLCB2YWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gT3BlbiBkcm9wZG93blxuICAgICAgICBpZiAoIXRoaXMuZHJvcGRvd24uaXNPcGVuKSB7XG4gICAgICAgICAgLy8gVGltZW91dCB0byBwcmV2ZW50IGRyb3Bkb3duIHRlbXAgZG9jIGNsaWNrIGhhbmRsZXIgZnJvbSBmaXJpbmdcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpO1xuICAgICAgICAgIH0sIDEwMCk7XG5cbiAgICAgICAgLy8gUmVjYWxjdWxhdGUgZHJvcGRvd24gd2hlbiBpdHMgYWxyZWFkeSBvcGVuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5kcm9wZG93bi5yZWNhbGN1bGF0ZURpbWVuc2lvbnMoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgb2xkVmFsXG4gICAgICB0aGlzLm9sZFZhbCA9IHZhbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgSW5wdXQgS2V5ZG93blxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICAgKi9cbiAgICBfaGFuZGxlSW5wdXRLZXlkb3duKGUpIHtcbiAgICAgIEF1dG9jb21wbGV0ZS5fa2V5ZG93biA9IHRydWU7XG5cbiAgICAgIC8vIEFycm93IGtleXMgYW5kIGVudGVyIGtleSB1c2FnZVxuICAgICAgbGV0IGtleUNvZGUgPSBlLmtleUNvZGUsXG4gICAgICAgIGxpRWxlbWVudCxcbiAgICAgICAgbnVtSXRlbXMgPSAkKHRoaXMuY29udGFpbmVyKS5jaGlsZHJlbignbGknKS5sZW5ndGg7XG5cbiAgICAgIC8vIHNlbGVjdCBlbGVtZW50IG9uIEVudGVyXG4gICAgICBpZiAoa2V5Q29kZSA9PT0gMTMgJiYgdGhpcy5hY3RpdmVJbmRleCA+PSAwKSB7XG4gICAgICAgIGxpRWxlbWVudCA9ICQodGhpcy5jb250YWluZXIpLmNoaWxkcmVuKCdsaScpLmVxKHRoaXMuYWN0aXZlSW5kZXgpO1xuICAgICAgICBpZiAobGlFbGVtZW50Lmxlbmd0aCkge1xuICAgICAgICAgIHRoaXMuc2VsZWN0T3B0aW9uKGxpRWxlbWVudCk7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gQ2FwdHVyZSB1cCBhbmQgZG93biBrZXlcbiAgICAgIGlmIChrZXlDb2RlID09PSAzOCB8fCBrZXlDb2RlID09PSA0MCkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgaWYgKGtleUNvZGUgPT09IDM4ICYmXG4gICAgICAgICAgdGhpcy5hY3RpdmVJbmRleCA+IDApIHtcbiAgICAgICAgICB0aGlzLmFjdGl2ZUluZGV4LS07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoa2V5Q29kZSA9PT0gNDAgJiZcbiAgICAgICAgICB0aGlzLmFjdGl2ZUluZGV4IDwgKG51bUl0ZW1zIC0gMSkpIHtcbiAgICAgICAgICB0aGlzLmFjdGl2ZUluZGV4Kys7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLiRhY3RpdmUucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICBpZiAodGhpcy5hY3RpdmVJbmRleCA+PSAwKSB7XG4gICAgICAgICAgdGhpcy4kYWN0aXZlID0gJCh0aGlzLmNvbnRhaW5lcikuY2hpbGRyZW4oJ2xpJykuZXEodGhpcy5hY3RpdmVJbmRleCk7XG4gICAgICAgICAgdGhpcy4kYWN0aXZlLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBDb250YWluZXIgTW91c2Vkb3duIGFuZCBUb3VjaHN0YXJ0XG4gICAgICogQHBhcmFtIHtFdmVudH0gZVxuICAgICAqL1xuICAgIF9oYW5kbGVDb250YWluZXJNb3VzZWRvd25BbmRUb3VjaHN0YXJ0KGUpIHtcbiAgICAgIGxldCAkYXV0b2NvbXBsZXRlT3B0aW9uID0gJChlLnRhcmdldCkuY2xvc2VzdCgnbGknKTtcbiAgICAgIHRoaXMuc2VsZWN0T3B0aW9uKCRhdXRvY29tcGxldGVPcHRpb24pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhpZ2hsaWdodCBwYXJ0aWFsIG1hdGNoXG4gICAgICovXG4gICAgX2hpZ2hsaWdodChzdHJpbmcsICRlbCkge1xuICAgICAgbGV0IGltZyA9ICRlbC5maW5kKCdpbWcnKTtcbiAgICAgIGxldCBtYXRjaFN0YXJ0ID0gJGVsLnRleHQoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJcIiArIHN0cmluZy50b0xvd2VyQ2FzZSgpICsgXCJcIiksXG4gICAgICAgIG1hdGNoRW5kID0gbWF0Y2hTdGFydCArIHN0cmluZy5sZW5ndGggLSAxLFxuICAgICAgICBiZWZvcmVNYXRjaCA9ICRlbC50ZXh0KCkuc2xpY2UoMCwgbWF0Y2hTdGFydCksXG4gICAgICAgIG1hdGNoVGV4dCA9ICRlbC50ZXh0KCkuc2xpY2UobWF0Y2hTdGFydCwgbWF0Y2hFbmQgKyAxKSxcbiAgICAgICAgYWZ0ZXJNYXRjaCA9ICRlbC50ZXh0KCkuc2xpY2UobWF0Y2hFbmQgKyAxKTtcbiAgICAgICRlbC5odG1sKFwiPHNwYW4+XCIgKyBiZWZvcmVNYXRjaCArIFwiPHNwYW4gY2xhc3M9J2hpZ2hsaWdodCc+XCIgKyBtYXRjaFRleHQgKyBcIjwvc3Bhbj5cIiArIGFmdGVyTWF0Y2ggKyBcIjwvc3Bhbj5cIik7XG4gICAgICBpZiAoaW1nLmxlbmd0aCkge1xuICAgICAgICAkZWwucHJlcGVuZChpbWcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc2V0IGN1cnJlbnQgZWxlbWVudCBwb3NpdGlvblxuICAgICAqL1xuICAgIF9yZXNldEN1cnJlbnRFbGVtZW50KCkge1xuICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IC0xO1xuICAgICAgdGhpcy4kYWN0aXZlLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXNldCBhdXRvY29tcGxldGUgZWxlbWVudHNcbiAgICAgKi9cbiAgICBfcmVzZXRBdXRvY29tcGxldGUoKSB7XG4gICAgICAkKHRoaXMuY29udGFpbmVyKS5lbXB0eSgpO1xuICAgICAgdGhpcy5fcmVzZXRDdXJyZW50RWxlbWVudCgpO1xuICAgICAgdGhpcy5vbGRWYWwgPSBudWxsO1xuICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWxlY3QgYXV0b2NvbXBsZXRlIG9wdGlvblxuICAgICAqIEBwYXJhbSB7RWxlbWVudH0gZWwgIEF1dG9jb21wbGV0ZSBvcHRpb24gbGlzdCBpdGVtIGVsZW1lbnRcbiAgICAgKi9cbiAgICBzZWxlY3RPcHRpb24oZWwpIHtcbiAgICAgIGxldCB0ZXh0ID0gZWwudGV4dCgpLnRyaW0oKTtcbiAgICAgIHRoaXMuZWwudmFsdWUgPSB0ZXh0O1xuICAgICAgdGhpcy4kZWwudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgICB0aGlzLl9yZXNldEF1dG9jb21wbGV0ZSgpO1xuICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpO1xuXG4gICAgICAvLyBIYW5kbGUgb25BdXRvY29tcGxldGUgY2FsbGJhY2suXG4gICAgICBpZiAodHlwZW9mICh0aGlzLm9wdGlvbnMub25BdXRvY29tcGxldGUpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5vbkF1dG9jb21wbGV0ZS5jYWxsKHRoaXMsIHRleHQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbmRlciBkcm9wZG93biBjb250ZW50XG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgIGRhdGEgc2V0XG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbCAgY3VycmVudCBpbnB1dCB2YWx1ZVxuICAgICAqL1xuICAgIF9yZW5kZXJEcm9wZG93bihkYXRhLCB2YWwpIHtcbiAgICAgIHRoaXMuX3Jlc2V0QXV0b2NvbXBsZXRlKCk7XG5cbiAgICAgIGxldCBtYXRjaGluZ0RhdGEgPSBbXTtcblxuICAgICAgLy8gR2F0aGVyIGFsbCBtYXRjaGluZyBkYXRhXG4gICAgICBmb3IgKGxldCBrZXkgaW4gZGF0YSkge1xuICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpICYmXG4gICAgICAgICAga2V5LnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2YWwpICE9PSAtMSkge1xuICAgICAgICAgIC8vIEJyZWFrIGlmIHBhc3QgbGltaXRcbiAgICAgICAgICBpZiAodGhpcy5jb3VudCA+PSB0aGlzLm9wdGlvbnMubGltaXQpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGxldCBlbnRyeSA9IHtcbiAgICAgICAgICAgIGRhdGE6IGRhdGFba2V5XSxcbiAgICAgICAgICAgIGtleToga2V5XG4gICAgICAgICAgfTtcbiAgICAgICAgICBtYXRjaGluZ0RhdGEucHVzaChlbnRyeSk7XG5cbiAgICAgICAgICB0aGlzLmNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gU29ydFxuICAgICAgbGV0IHNvcnRGdW5jdGlvbkJvdW5kID0gKGEsIGIpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5zb3J0RnVuY3Rpb24oYS5rZXkudG9Mb3dlckNhc2UoKSwgYi5rZXkudG9Mb3dlckNhc2UoKSwgdmFsLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfTtcbiAgICAgIG1hdGNoaW5nRGF0YS5zb3J0KHNvcnRGdW5jdGlvbkJvdW5kKTtcblxuICAgICAgLy8gUmVuZGVyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1hdGNoaW5nRGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQgZW50cnkgPSBtYXRjaGluZ0RhdGFbaV07XG4gICAgICAgIGxldCAkYXV0b2NvbXBsZXRlT3B0aW9uID0gJCgnPGxpPjwvbGk+Jyk7XG4gICAgICAgIGlmICghIWVudHJ5LmRhdGEpIHtcbiAgICAgICAgICAkYXV0b2NvbXBsZXRlT3B0aW9uLmFwcGVuZCgnPGltZyBzcmM9XCInICsgZW50cnkuZGF0YSArICdcIiBjbGFzcz1cInJpZ2h0IGNpcmNsZVwiPjxzcGFuPicgKyBlbnRyeS5rZXkgKyAnPC9zcGFuPicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRhdXRvY29tcGxldGVPcHRpb24uYXBwZW5kKCc8c3Bhbj4nICsgZW50cnkua2V5ICsgJzwvc3Bhbj4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgICQodGhpcy5jb250YWluZXIpLmFwcGVuZCgkYXV0b2NvbXBsZXRlT3B0aW9uKTtcbiAgICAgICAgdGhpcy5faGlnaGxpZ2h0KHZhbCwgJGF1dG9jb21wbGV0ZU9wdGlvbik7XG4gICAgICB9XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgRGF0YVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICovXG4gICAgdXBkYXRlRGF0YShkYXRhKSB7XG4gICAgICBsZXQgdmFsID0gdGhpcy5lbC52YWx1ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgdGhpcy5vcHRpb25zLmRhdGEgPSBkYXRhO1xuXG4gICAgICBpZiAodGhpcy5pc09wZW4pIHtcbiAgICAgICAgdGhpcy5fcmVuZGVyRHJvcGRvd24oZGF0YSwgdmFsKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyb2YgQXV0b2NvbXBsZXRlXG4gICAqL1xuICBBdXRvY29tcGxldGUuX2tleWRvd24gPSBmYWxzZTtcblxuICBNLkF1dG9jb21wbGV0ZSA9IEF1dG9jb21wbGV0ZTtcblxuICBpZiAoTS5qUXVlcnlMb2FkZWQpIHtcbiAgICBNLmluaXRpYWxpemVKcXVlcnlXcmFwcGVyKEF1dG9jb21wbGV0ZSwgJ2F1dG9jb21wbGV0ZScsICdNX0F1dG9jb21wbGV0ZScpO1xuICB9XG5cbn0oY2FzaCkpO1xuIl19
