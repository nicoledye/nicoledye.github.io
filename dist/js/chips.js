"use strict";var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),_get=function e(t,i,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in s)return s.value;var h=s.get;return void 0!==h?h.call(n):void 0};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}!function(u){var t={data:[],placeholder:"",secondaryPlaceholder:"",autocompleteOptions:{},limit:1/0,onChipAdd:null,onChipSelect:null,onChipDelete:null},e=function(e){function a(e,t){_classCallCheck(this,a);var i=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,a,e,t));return(i.el.M_Chips=i).options=u.extend({},a.defaults,t),i.$el.addClass("chips input-field"),i.chipsData=[],i.$chips=u(),i._setupInput(),i.hasAutocomplete=0<Object.keys(i.options.autocompleteOptions).length,i.$input.attr("id")||i.$input.attr("id",M.guid()),i.options.data.length&&(i.chipsData=i.options.data,i._renderChips(i.chipsData)),i.hasAutocomplete&&i._setupAutocomplete(),i._setPlaceholder(),i._setupLabel(),i._setupEventHandlers(),i}return _inherits(a,Component),_createClass(a,[{key:"getData",value:function(){return this.chipsData}},{key:"destroy",value:function(){this._removeEventHandlers(),this.$chips.remove(),this.el.M_Chips=void 0}},{key:"_setupEventHandlers",value:function(){this._handleChipClickBound=this._handleChipClick.bind(this),this._handleInputKeydownBound=this._handleInputKeydown.bind(this),this._handleInputFocusBound=this._handleInputFocus.bind(this),this._handleInputBlurBound=this._handleInputBlur.bind(this),this.el.addEventListener("click",this._handleChipClickBound),document.addEventListener("keydown",a._handleChipsKeydown),document.addEventListener("keyup",a._handleChipsKeyup),this.el.addEventListener("blur",a._handleChipsBlur,!0),this.$input[0].addEventListener("focus",this._handleInputFocusBound),this.$input[0].addEventListener("blur",this._handleInputBlurBound),this.$input[0].addEventListener("keydown",this._handleInputKeydownBound)}},{key:"_removeEventHandlers",value:function(){this.el.removeEventListener("click",this._handleChipClickBound),document.removeEventListener("keydown",a._handleChipsKeydown),document.removeEventListener("keyup",a._handleChipsKeyup),this.el.removeEventListener("blur",a._handleChipsBlur,!0),this.$input[0].removeEventListener("focus",this._handleInputFocusBound),this.$input[0].removeEventListener("blur",this._handleInputBlurBound),this.$input[0].removeEventListener("keydown",this._handleInputKeydownBound)}},{key:"_handleChipClick",value:function(e){var t=u(e.target).closest(".chip"),i=u(e.target).is(".close");if(t.length){var n=t.index();i?(this.deleteChip(n),this.$input[0].focus()):this.selectChip(n)}else this.$input[0].focus()}},{key:"_handleInputFocus",value:function(){this.$el.addClass("focus")}},{key:"_handleInputBlur",value:function(){this.$el.removeClass("focus")}},{key:"_handleInputKeydown",value:function(e){if(a._keydown=!0,13===e.keyCode){if(this.hasAutocomplete&&this.autocomplete&&this.autocomplete.isOpen)return;e.preventDefault(),this.addChip({tag:this.$input[0].value}),this.$input[0].value=""}else 8!==e.keyCode&&37!==e.keyCode||""!==this.$input[0].value||!this.chipsData.length||(e.preventDefault(),this.selectChip(this.chipsData.length-1))}},{key:"_renderChip",value:function(e){if(e.tag){var t=document.createElement("div"),i=document.createElement("i");if(t.classList.add("chip"),t.textContent=e.tag,t.setAttribute("tabindex",0),u(i).addClass("material-icons close"),i.textContent="close",e.image){var n=document.createElement("img");n.setAttribute("src",e.image),t.insertBefore(n,t.firstChild)}return t.appendChild(i),t}}},{key:"_renderChips",value:function(){this.$chips.remove();for(var e=0;e<this.chipsData.length;e++){var t=this._renderChip(this.chipsData[e]);this.$el.append(t),this.$chips.add(t)}this.$el.append(this.$input[0])}},{key:"_setupAutocomplete",value:function(){var t=this;this.options.autocompleteOptions.onAutocomplete=function(e){t.addChip({tag:e}),t.$input[0].value="",t.$input[0].focus()},this.autocomplete=M.Autocomplete.init(this.$input[0],this.options.autocompleteOptions)}},{key:"_setupInput",value:function(){this.$input=this.$el.find("input"),this.$input.length||(this.$input=u("<input></input>"),this.$el.append(this.$input)),this.$input.addClass("input")}},{key:"_setupLabel",value:function(){this.$label=this.$el.find("label"),this.$label.length&&this.$label.setAttribute("for",this.$input.attr("id"))}},{key:"_setPlaceholder",value:function(){void 0!==this.chipsData&&!this.chipsData.length&&this.options.placeholder?u(this.$input).prop("placeholder",this.options.placeholder):(void 0===this.chipsData||this.chipsData.length)&&this.options.secondaryPlaceholder&&u(this.$input).prop("placeholder",this.options.secondaryPlaceholder)}},{key:"_isValid",value:function(e){if(e.hasOwnProperty("tag")&&""!==e.tag){for(var t=!1,i=0;i<this.chipsData.length;i++)if(this.chipsData[i].tag===e.tag){t=!0;break}return!t}return!1}},{key:"addChip",value:function(e){if(this._isValid(e)&&!(this.chipsData.length>=this.options.limit)){var t=this._renderChip(e);this.$chips.add(t),this.chipsData.push(e),u(this.$input).before(t),this._setPlaceholder(),"function"==typeof this.options.onChipAdd&&this.options.onChipAdd.call(this,this.$el,t)}}},{key:"deleteChip",value:function(e){var t=this.$chips.eq(e);this.$chips.eq(e).remove(),this.$chips=this.$chips.filter(function(e){return 0<=u(e).index()}),this.chipsData.splice(e,1),this._setPlaceholder(),"function"==typeof this.options.onChipDelete&&this.options.onChipDelete.call(this,this.$el,t[0])}},{key:"selectChip",value:function(e){var t=this.$chips.eq(e);(this._selectedChip=t)[0].focus(),"function"==typeof this.options.onChipSelect&&this.options.onChipSelect.call(this,this.$el,t[0])}}],[{key:"init",value:function(e,t){return _get(a.__proto__||Object.getPrototypeOf(a),"init",this).call(this,this,e,t)}},{key:"getInstance",value:function(e){return(e.jquery?e[0]:e).M_Chips}},{key:"_handleChipsKeydown",value:function(e){a._keydown=!0;var t=u(e.target).closest(".chips"),i=e.target&&t.length;if(!u(e.target).is("input, textarea")&&i){var n=t[0].M_Chips;if(8===e.keyCode||46===e.keyCode){e.preventDefault();var s=n.chipsData.length;if(n._selectedChip){var o=n._selectedChip.index();n.deleteChip(o),n._selectedChip=null,s=Math.max(o-1,0)}n.chipsData.length&&n.selectChip(s)}else if(37===e.keyCode){if(n._selectedChip){var h=n._selectedChip.index()-1;if(h<0)return;n.selectChip(h)}}else if(39===e.keyCode&&n._selectedChip){var l=n._selectedChip.index()+1;l>=n.chipsData.length?n.$input[0].focus():n.selectChip(l)}}}},{key:"_handleChipsKeyup",value:function(e){a._keydown=!1}},{key:"_handleChipsBlur",value:function(e){a._keydown||(u(e.target).closest(".chips")[0].M_Chips._selectedChip=null)}},{key:"defaults",get:function(){return t}}]),a}();e._keydown=!1,M.Chips=e,M.jQueryLoaded&&M.initializeJqueryWrapper(e,"chips","M_Chips"),u(document).ready(function(){u(document.body).on("click",".chip .close",function(){var e=u(this).closest(".chips");e.length&&e[0].M_Chips||u(this).closest(".chip").remove()})})}(cash);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoaXBzLmpzIl0sIm5hbWVzIjpbIiQiLCJfZGVmYXVsdHMiLCJkYXRhIiwicGxhY2Vob2xkZXIiLCJzZWNvbmRhcnlQbGFjZWhvbGRlciIsImF1dG9jb21wbGV0ZU9wdGlvbnMiLCJsaW1pdCIsIkluZmluaXR5Iiwib25DaGlwQWRkIiwib25DaGlwU2VsZWN0Iiwib25DaGlwRGVsZXRlIiwiQ2hpcHMiLCJfQ29tcG9uZW50IiwiZWwiLCJvcHRpb25zIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsIl90aGlzIiwiX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iLCJfX3Byb3RvX18iLCJPYmplY3QiLCJnZXRQcm90b3R5cGVPZiIsImNhbGwiLCJNX0NoaXBzIiwiZXh0ZW5kIiwiZGVmYXVsdHMiLCIkZWwiLCJhZGRDbGFzcyIsImNoaXBzRGF0YSIsIiRjaGlwcyIsIl9zZXR1cElucHV0IiwiaGFzQXV0b2NvbXBsZXRlIiwia2V5cyIsImxlbmd0aCIsIiRpbnB1dCIsImF0dHIiLCJNIiwiZ3VpZCIsIl9zZXRQbGFjZWhvbGRlciIsIl9zZXR1cExhYmVsIiwiX3NldHVwRXZlbnRIYW5kbGVycyIsIl9pbmhlcml0cyIsIkNvbXBvbmVudCIsIl9jcmVhdGVDbGFzcyIsImtleSIsInZhbHVlIiwiX3JlbW92ZUV2ZW50SGFuZGxlcnMiLCJyZW1vdmUiLCJ1bmRlZmluZWQiLCJfaGFuZGxlQ2hpcENsaWNrQm91bmQiLCJfaGFuZGxlQ2hpcENsaWNrIiwiYmluZCIsIl9oYW5kbGVJbnB1dEtleWRvd25Cb3VuZCIsIl9oYW5kbGVJbnB1dEtleWRvd24iLCJfaGFuZGxlSW5wdXRGb2N1c0JvdW5kIiwiX2hhbmRsZUlucHV0Rm9jdXMiLCJfaGFuZGxlSW5wdXRCbHVyQm91bmQiLCJfaGFuZGxlSW5wdXRCbHVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImRvY3VtZW50IiwiX2hhbmRsZUNoaXBzS2V5ZG93biIsIl9oYW5kbGVDaGlwc0tleXVwIiwiX2hhbmRsZUNoaXBzQmx1ciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJlIiwiJGNoaXAiLCJpcyIsImluZGV4IiwiY2xpY2tlZENsb3NlIiwiZm9jdXMiLCJzZWxlY3RDaGlwIiwiY2xvc2VJY29uIiwidGV4dENvbnRlbnQiLCJfa2V5ZG93biIsImtleUNvZGUiLCJhdXRvY29tcGxldGUiLCJpc09wZW4iLCJwcmV2ZW50RGVmYXVsdCIsInRhZyIsImkiLCJhcHBlbmQiLCJjaGlwRWwiLCJjaGlwIiwidmFsIiwiY3JlYXRlRWxlbWVudCIsInJlbmRlcmVkQ2hpcCIsInNldEF0dHJpYnV0ZSIsIkF1dG9jb21wbGV0ZSIsImltYWdlIiwiaW1nIiwiaW5zZXJ0QmVmb3JlIiwiZmlyc3RDaGlsZCIsImFwcGVuZENoaWxkIiwiX3JlbmRlckNoaXAiLCJhZGQiLCJfdGhpczIiLCJvbkF1dG9jb21wbGV0ZSIsImFkZENoaXAiLCJwcm9wIiwiaW5pdCIsImZpbmQiLCIkbGFiZWwiLCJleGlzdHMiLCJfaXNWYWxpZCIsImJlZm9yZSIsImNoaXBJbmRleCIsImVxIiwic3BsaWNlIiwiZG9tRWxlbSIsImpxdWVyeSIsIl9zZWxlY3RlZENoaXAiLCJlbHMiLCJfZ2V0IiwiY2hpcHNLZXlkb3duIiwidGFyZ2V0IiwiY3VyckNoaXBzIiwic2VsZWN0SW5kZXgiLCJkZWxldGVDaGlwIiwiTWF0aCIsIm1heCIsImNsb3Nlc3QiLCJnZXQiLCJqUXVlcnlMb2FkZWQiXSwibWFwcGluZ3MiOiI0bkNBQUMsU0FBVUEsR0FHVCxJQUFJQyxFQUFZLENBQ2RDLEtBQU0sR0FDTkMsWUFBYSxHQUNiQyxxQkFBc0IsR0FDdEJDLG9CQUFxQixHQUNyQkMsTUFBT0MsRUFBQUEsRUFDUEMsVUFBVyxLQUNYQyxhQUFjLEtBQ2RDLGFBQWMsTUFjVkMsRUF6Qk0sU0FBQUMsR0FxQlosU0FBQUQsRUFBQUUsRUFBQUMsR0FBQUMsZ0JBQUFDLEtBQUFMLEdBQUEsSUFBQU0sRUFBQUMsMkJBQUFGLE1BQUFMLEVBQUFRLFdBQUFDLE9BQUFDLGVBQUFWLElBQUFXLEtBQUFOLEtBWVVMLEVBQU9FLEVBQUlDLElBWnJCLE9BY0lHLEVBQUtKLEdBQUdVLFFBQVJOLEdBVUtILFFBQVVkLEVBQUV3QixPQUFPLEdBQUliLEVBQU1jLFNBQVVYLEdBYnJCRyxFQUFBUyxJQUFBQyxTQUFBLHFCQWdCdkJWLEVBQUtXLFVBQVksR0FoQk1YLEVBQUFZLE9BQUE3QixJQWtCdkJpQixFQUFLYSxjQWZMYixFQUFBYyxnQkFBQSxFQUFBWCxPQUFBWSxLQUFBZixFQUFBSCxRQUFBVCxxQkFBQTRCLE9BbUJLaEIsRUFBS2lCLE9BQU9DLEtBQUssT0FDcEJsQixFQUFLaUIsT0FBT0MsS0FBSyxLQUFNQyxFQUFFQyxRQUl2QnBCLEVBQUtILFFBQVFaLEtBQUsrQixTQUNwQmhCLEVBQUtXLFVBQVlYLEVBQUtILFFBQVFaLEtBZmhDZSxFQUFLSCxhQUFZVSxFQUFPSSxZQUl4QlgsRUFBS1ksaUJBQ0xaLEVBQUthLHFCQUdMYixFQUFBcUIsa0JBQ0FyQixFQUFLc0IsY0FDSHRCLEVBQUF1QixzQkFsQ052QixFQXJCWSxPQUFBd0IsVUFBQTlCLEVBeUJRK0IsV0F6QlJDLGFBQUFoQyxFQUFBLENBQUEsQ0FBQWlDLElBQUEsVUFBQUMsTUFBQSxXQThGUixPQUFPN0IsS0FBS1ksWUE5RkosQ0FBQWdCLElBQUEsVUFBQUMsTUFBQSxXQXFHUjdCLEtBQUs4Qix1QkFKUDlCLEtBQUFhLE9BQUFrQixTQU1FL0IsS0FBS0gsR0FBR1UsYUFBVXlCLElBdkdWLENBQUFKLElBQUEsc0JBQUFDLE1BQUEsV0FzR1I3QixLQUFBaUMsc0JBQUFqQyxLQUFBa0MsaUJBQUFDLEtBQUFuQyxNQUNBQSxLQUFBb0MseUJBQUFwQyxLQUFBcUMsb0JBQUFGLEtBQUFuQyxNQUNEQSxLQUFBc0MsdUJBQUF0QyxLQUFBdUMsa0JBQUFKLEtBQUFuQyxNQVNDQSxLQUFLd0Msc0JBQXdCeEMsS0FBS3lDLGlCQUFpQk4sS0FBS25DLE1BRXhEQSxLQUFLSCxHQUFHNkMsaUJBQWlCLFFBQVMxQyxLQUFLaUMsdUJBQ3ZDVSxTQUFTRCxpQkFBaUIsVUFBVy9DLEVBQU1pRCxxQkFDM0NELFNBQVNELGlCQUFpQixRQUFTL0MsRUFBTWtELG1CQXJIakM3QyxLQUFBSCxHQUFBNkMsaUJBQUEsT0FBQS9DLEVBQUFtRCxrQkFBQSxHQUFBOUMsS0FBQWtCLE9BQUEsR0FBQXdCLGlCQUFBLFFBQUExQyxLQUFBc0Msd0JBQUF0QyxLQUFBa0IsT0FBQSxHQUFBd0IsaUJBQUEsT0E2R1kxQyxLQUFBd0MsdUJBQ3BCeEMsS0FBQWtCLE9BQUtlLEdBQUFBLGlCQUF3QixVQUFLQyxLQUFBQSw0QkE5RzFCLENBQUFOLElBQUEsdUJBQUFDLE1BQUEsV0FxSFJjLEtBQUFBLEdBQUFBLG9CQUEwQixRQUFTaEQsS0FBQUEsdUJBQ25DZ0QsU0FBQUksb0JBQXlCLFVBQVFwRCxFQUFNbUQscUJBQ3ZDSCxTQUFLekIsb0JBQVV3QixRQUFpQi9DLEVBQVNrRCxtQkFDekM3QyxLQUFBSCxHQUFLcUIsb0JBQVV3QixPQUFpQi9DLEVBQVFtRCxrQkFBS04sR0FDN0N4QyxLQUFBa0IsT0FBS0EsR0FBTDZCLG9CQUFnQyxRQUFoQy9DLEtBQTJDc0Msd0JBQzVDdEMsS0FBQWtCLE9BQUEsR0FBQTZCLG9CQUFBLE9BQUEvQyxLQUFBd0MsdUJBWUN4QyxLQUFLa0IsT0FBTyxHQUFHNkIsb0JBQW9CLFVBQVcvQyxLQUFLb0MsNEJBdEkzQyxDQUFBUixJQUFBLG1CQUFBQyxNQUFBLFNBQUFtQixHQWdJUixJQUFBQyxFQUFRRixFQUFBQSxFQUFBQSxRQUFBQSxRQUFvQixTQUM1QkosRUFBU0ksRUFBQUEsRUFBQUEsUUFBb0JHLEdBQUEsVUFDN0JQLEdBQUFBLEVBQUFBLE9BQVNJLENBQ1QsSUFBQUksRUFBUUosRUFBQUEsUUFDUkssR0FFQXBELEtBQUtrQixXQUFVNkIsR0FDaEIvQyxLQUFBa0IsT0FBQSxHQUFBbUMsU0FrQktyRCxLQUFLc0QsV0FBV0gsUUF6SlpuRCxLQUFBa0IsT0FBQSxHQUFBbUMsVUFBQSxDQUFBekIsSUFBQSxvQkFBQUMsTUFBQSxXQXNQUjdCLEtBQUtVLElBQUlDLFNBQVMsV0F0UFYsQ0FBQWlCLElBQUEsbUJBQUFDLE1BQUEsV0E2U1IwQixLQUFBQSxJQUFBQSxZQUFVQyxXQTdTRixDQUFBNUIsSUFBQSxzQkFBQUMsTUFBQSxTQW9UUG1CLEdBSUYsR0FuRENyRCxFQUFNOEQsVUFBVyxFQW1EbEIsS0FBQVQsRUFBQVUsUUFBQSxDQUVELEdBQUExRCxLQUFBZSxpQkEvQ01mLEtBQUsyRCxjQUNMM0QsS0FBSzJELGFBQWFDLE9BQ2xCLE9BN1FJWixFQUFBYSxpQkE4VFI3RCxLQUFLYSxRQUFPa0IsQ0FDWitCLElBQUs5RCxLQUFJK0QsT0FBT0EsR0FBSWxDLFFBRWxCN0IsS0FBQWtCLE9BQVM4QyxHQUFBQSxNQUFPQyxRQTFDUSxJQUFkakIsRUFBRVUsU0FBK0IsS0FBZFYsRUFBRVUsU0FBNEMsS0FBekIxRCxLQUFLa0IsT0FBTyxHQUFHVyxRQUFnQjdCLEtBQUtZLFVBQVVLLFNBOENsRytCLEVBQUFhLGlCQUNBN0QsS0FBS1UsV0FBV1YsS0FBS2tCLFVBQXJCRCxPQUFBLE1BdFVRLENBQUFXLElBQUEsY0FBQUMsTUFBQSxTQUFBcUMsR0E0VVcsR0FBQUEsRUFBQUosSUFBQSxDQUdmQSxJQUFBQSxFQUFLSyxTQUFBQSxjQUFBQSxPQURNWixFQUFiWixTQUFBeUIsY0FBQSxLQVVKLEdBUElDLEVBQUtuRCxVQUFVVyxJQUFmLFFBQ0F3QyxFQUFLbkQsWUFBTGdELEVBQUFKLElBQ0RPLEVBTkRDLGFBQUEsV0FBQSxHQWpDQXRGLEVBQUV1RSxHQUFXNUMsU0FBUyx3QkF5Q3RCNEMsRUFBS0ksWUFBaUJZLFFBR3hCTCxFQUFBTSxNQUFBLENBdkNJLElBQUlDLEVBQU05QixTQUFTeUIsY0FBYyxPQUNqQ0ssRUFBSUgsYUFBYSxNQUFPSixFQUFLTSxPQUM3QkgsRUFBYUssYUFBYUQsRUFBS0osRUFBYU0sWUF5QzlDLE9BNVZRTixFQUFBTyxZQUFBckIsR0E0VkhyQyxLQTVWRyxDQUFBVSxJQUFBLGVBQUFDLE1BQUEsV0FtV1Q3QixLQUFBYSxPQUFBa0IsU0FwQ0MsSUFBSyxJQUFJZ0MsRUFBSSxFQUFHQSxFQUFJL0QsS0FBS1ksVUFBVUssT0FBUThDLElBQUssQ0FzQ2xELElBQUFFLEVBQUFqRSxLQUFBNkUsWUFBQTdFLEtBQUFZLFVBQUFtRCxJQXBDSS9ELEtBQUtVLElBQUlzRCxPQUFPQyxHQUNoQmpFLEtBQUthLE9BQU9pRSxJQUFJYixHQWxVVmpFLEtBQUFVLElBQUFzRCxPQUFBaEUsS0FBQWtCLE9BQUEsTUFBQSxDQUFBVSxJQUFBLHFCQUFBQyxNQUFBLFdBNFVXLElBQUFrRCxFQUFBL0UsS0FtQ3JCQSxLQUFBRixRQUFBVCxvQkFBQTJGLGVBQUEsU0FBQWIsR0FqQ0lZLEVBQUtFLFFBQVEsQ0FDWG5CLElBQUtLLElBL1VEWSxFQUFBN0QsT0FBQSxHQUFBVyxNQUFBLEdBQUFrRCxFQUFBN0QsT0FBQSxHQUFBbUMsU0FvWE5yRSxLQUFBQSxhQUFla0csRUFBQUEsYUFBS0MsS0FBZW5GLEtBQUtGLE9BQVFYLEdBQUFBLEtBQUFBLFFBQWhERSx1QkFwWE0sQ0FBQXVDLElBQUEsY0FBQUMsTUFBQSxXQTRWUjdCLEtBQUtrQixPQUFTbEIsS0FBS1UsSUFBSTBFLEtBQUssU0FDdkJwRixLQUFLa0IsT0FBT0QsU0FDZmpCLEtBQUtrQixPQUFTbEMsRUFBRSxtQkFDaEJnQixLQUFLVSxJQUFJc0QsT0FBT2hFLEtBQUtrQixTQS9WZmxCLEtBQUFrQixPQUFBUCxTQUFBLFdBQUEsQ0FBQWlCLElBQUEsY0FBQUMsTUFBQSxXQXNZSDdCLEtBQUFxRixPQUFBckYsS0FBQVUsSUFBQTBFLEtBQUEsU0FDRnBGLEtBQUFxRixPQUFBcEUsUUFDRGpCLEtBQUFxRixPQUFRQyxhQUFSLE1BQUF0RixLQUFBa0IsT0FBQUMsS0FBQSxTQXhZTSxDQUFBUyxJQUFBLGtCQUFBQyxNQUFBLGdCQW1YZ0JHLElBQW5CaEMsS0FBS1ksWUFBNEJaLEtBQUtZLFVBQVVLLFFBQVdqQixLQUFLRixRQUFRWCxZQUMzRUgsRUFBRWdCLEtBQUtrQixRQUFRZ0UsS0FBSyxjQUFlbEYsS0FBS0YsUUFBUVgsbUJBcFgxQzZDLElBQUFoQyxLQUFBWSxXQUFBWixLQUFBWSxVQUFBSyxTQUFBakIsS0FBQUYsUUFBQVYsc0JBQUFKLEVBQUFnQixLQUFBa0IsUUFBQWdFLEtBQUEsY0FBQWxGLEtBQUFGLFFBQUFWLHdCQUFBLENBQUF3QyxJQUFBLFdBQUFDLE1BQUEsU0EyWkhqQixHQUNMNUIsR0FBRWtGLEVBQUtoRCxlQUFlbUQsUUFBdEIsS0FBc0JBLEVBQXRCUCxJQUFBLENBMUJFLElBMkJGLElBQUF3QixHQUFLaEUsRUEzQk15QyxFQUFJLEVBQUdBLEVBQUkvRCxLQUFLWSxVQUFVSyxPQUFROEMsSUE2QjdDLEdBQUEvRCxLQUFBWSxVQUFBbUQsR0FBQUQsTUFBQUksRUFBQUosSUFBQSxDQUNJd0IsR0FBUSxFQUNWLE1BekJBLE9BQVFBLEVBSVYsT0FBTyxJQTVZQyxDQUFBMUQsSUFBQSxVQUFBQyxNQUFBLFNBNGFScUMsR0FDRSxHQUFBbEUsS0FBQXVGLFNBQWFwQyxNQUNkbkQsS0FGRFksVUFBQUssUUFBQWpCLEtBQUFGLFFBQUFSLE9BQ0UsQ0FLRixJQUFBK0UsRUFBQXJFLEtBQUE2RSxZQUFBWCxHQUNBbEUsS0FBQWEsT0FBSWlFLElBQVFULEdBQ1ZyRSxLQUFBWSxVQUFLZCxLQUFRSixHQUNkVixFQUFBZ0IsS0FBQWtCLFFBQUFzRSxPQUFBbkIsR0FDRnJFLEtBQUFzQixrQkF0QnlDLG1CQUE1QnRCLEtBQUtGLFFBQVFOLFdBQ3ZCUSxLQUFLRixRQUFRTixVQUFVYyxLQUFLTixLQUFNQSxLQUFLVSxJQUFLMkQsTUFqYXRDLENBQUF6QyxJQUFBLGFBQUFDLE1BQUEsU0ErYlI0RCxHQXJCQSxJQUFJeEMsRUFBUWpELEtBQUthLE9BQU82RSxHQUFHRCxHQXVCM0J6RixLQUFBYSxPQUFBNkUsR0FBQUQsR0FBQTFELFNBQ0EvQixLQUFBYSxPQUFZYixLQUFLRixPQUFRTCxPQUFBQSxTQUFrQkksR0FDekMsT0FBYUosR0FBUkssRUFBQUEsR0FBQUEsVUFFUkUsS0FBQVksVUFBQStFLE9BQUFGLEVBQUEsR0FyY1N6RixLQUFBc0Isa0JBK0VSLG1CQUFBdEIsS0FBQUYsUUFBQUosY0FDRE0sS0FBQUYsUUFBQUosYUFBQVksS0FBQU4sS0FBQUEsS0FBQVUsSUFBQXVDLEVBQUEsTUFoRlMsQ0FBQXJCLElBQUEsYUFBQUMsTUFBQSxTQUFBNEQsR0FzRlIsSUFBQXhDLEVBQUkyQyxLQUFXL0UsT0FBSWdGLEdBQUxKLElBQ2R6RixLQUFBOEYsY0FBZXZGLEdBQ2hCLEdBQUE4QyxRQThFNkIsbUJBdEtwQnJELEtBQUFGLFFBQUFMLGNBdUtSRSxLQUFBQSxRQUFNOEQsYUFBTm5ELEtBQUFOLEtBQUFBLEtBQUFVLElBQUF1QyxFQUFBLE9BdktRLENBQUEsQ0FBQXJCLElBQUEsT0FBQUMsTUFBQSxTQThEUGtFLEVBQUFqRyxHQWlCRCxPQUFBa0csS0FBQXJHLEVBQUFRLFdBQUFDLE9BQUFDLGVBQUFWLEdBQUEsT0FBQUssTUFBQU0sS0FBQU4sS0FBa0JBLEtBQU0rRixFQUFLakcsS0EvRXJCLENBQUE4QixJQUFBLGNBQUFDLE1BQUEsU0FxRUhQLEdBRUwsT0FES0MsRUFBTHNFLE9BQUFoRyxFQUFBLEdBQUFBLEdBQ0syQixVQXZFRyxDQUFBSSxJQUFBLHNCQUFBQyxNQUFBLFNBcUpXd0IsR0FFaEIxRCxFQUxEOEQsVUFLTyxFQUVMLElBQUE1QyxFQUFLeUMsRUFBQUEsRUFBQUEsUUFBV0gsUUFBaEIsVUFDRDhDLEVBQUFqRCxFQUFBa0QsUUFBQXJGLEVBQUFJLE9BR0YsSUFiRGpDLEVBQUFnRSxFQUFBa0QsUUFhT2hELEdBQUEsb0JBQUErQyxFQUFOLENBb0JELElBQUlFLEVBQVl0RixFQUFPLEdBQUdOLFFBRzFCLEdBQWtCLElBQWR5QyxFQUFFVSxTQUErQixLQUFkVixFQUFFVSxRQUFnQixDQUN2Q1YsRUFBRWEsaUJBckxJLElBQUF1QyxFQUFBRCxFQUFBdkYsVUFBQUssT0FBQSxHQUFBa0YsRUFBQUwsY0FBQSxDQXlMSixJQUFJM0MsRUFBUWdELEVBQVVMLGNBQWMzQyxRQUNwQ2dELEVBQVVFLFdBQVdsRCxHQXdEM0JnRCxFQUFBTCxjQUFBLEtBbFBVTSxFQUFBRSxLQUFBQyxJQUFBcEQsRUFBQSxFQXFQVSxHQXBEWmdELEVBQVV2RixVQUFVSyxRQXdENUJrRixFQUFBN0MsV0FBQThDLFFBelBVLEdBQUEsS0FBQXBELEVBQUFVLFNBQUEsR0FBQXlDLEVBQUFMLGNBQUEsQ0FBQSxJQUFBTSxFQUFBRCxFQUFBTCxjQTRQUzNDLFFBQUEsRUFDakIsR0FBS3pDLEVBQUwsRUFDRCxPQUVEeUYsRUFBQTdDLFdBQUE4QyxTQWhEUyxHQUFrQixLQUFkcEQsRUFBRVUsU0FoTkx5QyxFQUFBTCxjQUFBLENBQUEsSUFBQU0sRUFBQUQsRUFBQUwsY0FBQTNDLFFBQUEsRUFxUUZNLEdBQU4wQyxFQUFBdkYsVUFBQUssT0FoRE1rRixFQUFVakYsT0FBTyxHQUFHbUMsUUFtRHRCTCxFQUFBTSxXQUFrQjhDLE9BeFFkLENBQUF4RSxJQUFBLG9CQUFBQyxNQUFBLFNBb1JTQSxHQWxEakJsQyxFQUFNOEQsVUFBVyxJQWxPVCxDQUFBN0IsSUFBQSxtQkFBQUMsTUFBQSxTQXlPY21CLEdBb0R4QnJELEVBQUE4RCxXQWxEaUJ6RSxFQUFFZ0UsRUFBRWtELFFBQVFNLFFBQVEsVUFDVixHQUFHakcsUUFFaEJ1RixjQUFnQixRQTlPcEIsQ0FBQWxFLElBQUEsV0FBQTZFLElBQUEsV0EyRFIsT0FBSXhILE1BM0RJVSxFQUFBLEdBNGNaQSxFQUFNOEQsVUFBVyxFQUVqQnJDLEVBQUV6QixNQUFRQSxFQTFSTnlCLEVBQUFzRixjQUNFMUQsRUFBQUEsd0JBQUFyRCxFQUFBLFFBQUEsV0FHQVgsRUFBQTJELFVBQUl3RCxNQUFBQSxXQUVGQSxFQUFBQSxTQUFBQSxNQUFBQSxHQUFVRSxRQUFXbEQsZUFBckIsV0FDQWdELElBQUFBLEVBQUFBLEVBQUFBLE1BQVVMLFFBQVYsVUE2UkFqRixFQUFPSSxRQUFVSixFQUFPLEdBQUdOLFNBelI1QnZCLEVBQUFnQixNQUFBd0csUUFBQSxTQUFBekUsYUEvTFIsQ0FrTVNvRSIsImZpbGUiOiJjaGlwcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoJCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgbGV0IF9kZWZhdWx0cyA9IHtcbiAgICBkYXRhOiBbXSxcbiAgICBwbGFjZWhvbGRlcjogJycsXG4gICAgc2Vjb25kYXJ5UGxhY2Vob2xkZXI6ICcnLFxuICAgIGF1dG9jb21wbGV0ZU9wdGlvbnM6IHt9LFxuICAgIGxpbWl0OiBJbmZpbml0eSxcbiAgICBvbkNoaXBBZGQ6IG51bGwsXG4gICAgb25DaGlwU2VsZWN0OiBudWxsLFxuICAgIG9uQ2hpcERlbGV0ZTogbnVsbFxuICB9O1xuXG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IGNoaXBcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IHRhZyAgY2hpcCB0YWcgc3RyaW5nXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBbaW1hZ2VdICBjaGlwIGF2YXRhciBpbWFnZSBzdHJpbmdcbiAgICovXG5cbiAgLyoqXG4gICAqIEBjbGFzc1xuICAgKlxuICAgKi9cbiAgY2xhc3MgQ2hpcHMgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdCBDaGlwcyBpbnN0YW5jZSBhbmQgc2V0IHVwIG92ZXJsYXlcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlbCwgb3B0aW9ucykge1xuICAgICAgc3VwZXIoQ2hpcHMsIGVsLCBvcHRpb25zKTtcblxuICAgICAgdGhpcy5lbC5NX0NoaXBzID0gdGhpcztcblxuICAgICAgLyoqXG4gICAgICAgKiBPcHRpb25zIGZvciB0aGUgbW9kYWxcbiAgICAgICAqIEBtZW1iZXIgQ2hpcHMjb3B0aW9uc1xuICAgICAgICogQHByb3Age0FycmF5fSBkYXRhXG4gICAgICAgKiBAcHJvcCB7U3RyaW5nfSBwbGFjZWhvbGRlclxuICAgICAgICogQHByb3Age1N0cmluZ30gc2Vjb25kYXJ5UGxhY2Vob2xkZXJcbiAgICAgICAqIEBwcm9wIHtPYmplY3R9IGF1dG9jb21wbGV0ZU9wdGlvbnNcbiAgICAgICAqL1xuICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIENoaXBzLmRlZmF1bHRzLCBvcHRpb25zKTtcblxuICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ2NoaXBzIGlucHV0LWZpZWxkJyk7XG4gICAgICB0aGlzLmNoaXBzRGF0YSA9IFtdO1xuICAgICAgdGhpcy4kY2hpcHMgPSAkKCk7XG4gICAgICB0aGlzLl9zZXR1cElucHV0KCk7XG4gICAgICB0aGlzLmhhc0F1dG9jb21wbGV0ZSA9IE9iamVjdC5rZXlzKHRoaXMub3B0aW9ucy5hdXRvY29tcGxldGVPcHRpb25zKS5sZW5ndGggPiAwO1xuXG4gICAgICAvLyBTZXQgaW5wdXQgaWRcbiAgICAgIGlmICghdGhpcy4kaW5wdXQuYXR0cignaWQnKSkge1xuICAgICAgICB0aGlzLiRpbnB1dC5hdHRyKCdpZCcsIE0uZ3VpZCgpKTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVuZGVyIGluaXRpYWwgY2hpcHNcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5jaGlwc0RhdGEgPSB0aGlzLm9wdGlvbnMuZGF0YTtcbiAgICAgICAgdGhpcy5fcmVuZGVyQ2hpcHModGhpcy5jaGlwc0RhdGEpO1xuICAgICAgfVxuXG4gICAgICAvLyBTZXR1cCBhdXRvY29tcGxldGUgaWYgbmVlZGVkXG4gICAgICBpZiAodGhpcy5oYXNBdXRvY29tcGxldGUpIHtcbiAgICAgICAgdGhpcy5fc2V0dXBBdXRvY29tcGxldGUoKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fc2V0UGxhY2Vob2xkZXIoKTtcbiAgICAgIHRoaXMuX3NldHVwTGFiZWwoKTtcbiAgICAgIHRoaXMuX3NldHVwRXZlbnRIYW5kbGVycygpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgZGVmYXVsdHMoKSB7XG4gICAgICByZXR1cm4gX2RlZmF1bHRzO1xuICAgIH1cblxuICAgIHN0YXRpYyBpbml0KGVscywgb3B0aW9ucykge1xuICAgICAgcmV0dXJuIHN1cGVyLmluaXQodGhpcywgZWxzLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgSW5zdGFuY2VcbiAgICAgKi9cbiAgICBzdGF0aWMgZ2V0SW5zdGFuY2UoZWwpIHtcbiAgICAgIGxldCBkb21FbGVtID0gISFlbC5qcXVlcnkgPyBlbFswXSA6IGVsO1xuICAgICAgcmV0dXJuIGRvbUVsZW0uTV9DaGlwcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgQ2hpcHMgRGF0YVxuICAgICAqL1xuICAgIGdldERhdGEoKSB7XG4gICAgICByZXR1cm4gdGhpcy5jaGlwc0RhdGE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVhcmRvd24gY29tcG9uZW50XG4gICAgICovXG4gICAgZGVzdHJveSgpIHtcbiAgICAgIHRoaXMuX3JlbW92ZUV2ZW50SGFuZGxlcnMoKTtcbiAgICAgIHRoaXMuJGNoaXBzLnJlbW92ZSgpO1xuICAgICAgdGhpcy5lbC5NX0NoaXBzID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHVwIEV2ZW50IEhhbmRsZXJzXG4gICAgICovXG4gICAgX3NldHVwRXZlbnRIYW5kbGVycygpIHtcbiAgICAgIHRoaXMuX2hhbmRsZUNoaXBDbGlja0JvdW5kID0gdGhpcy5faGFuZGxlQ2hpcENsaWNrLmJpbmQodGhpcyk7XG4gICAgICB0aGlzLl9oYW5kbGVJbnB1dEtleWRvd25Cb3VuZCA9IHRoaXMuX2hhbmRsZUlucHV0S2V5ZG93bi5iaW5kKHRoaXMpO1xuICAgICAgdGhpcy5faGFuZGxlSW5wdXRGb2N1c0JvdW5kID0gdGhpcy5faGFuZGxlSW5wdXRGb2N1cy5iaW5kKHRoaXMpO1xuICAgICAgdGhpcy5faGFuZGxlSW5wdXRCbHVyQm91bmQgPSB0aGlzLl9oYW5kbGVJbnB1dEJsdXIuYmluZCh0aGlzKTtcblxuICAgICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2hhbmRsZUNoaXBDbGlja0JvdW5kKTtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBDaGlwcy5faGFuZGxlQ2hpcHNLZXlkb3duKTtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgQ2hpcHMuX2hhbmRsZUNoaXBzS2V5dXApO1xuICAgICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgQ2hpcHMuX2hhbmRsZUNoaXBzQmx1ciwgdHJ1ZSk7XG4gICAgICB0aGlzLiRpbnB1dFswXS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX2hhbmRsZUlucHV0Rm9jdXNCb3VuZCk7XG4gICAgICB0aGlzLiRpbnB1dFswXS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5faGFuZGxlSW5wdXRCbHVyQm91bmQpO1xuICAgICAgdGhpcy4kaW5wdXRbMF0uYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX2hhbmRsZUlucHV0S2V5ZG93bkJvdW5kKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgRXZlbnQgSGFuZGxlcnNcbiAgICAgKi9cbiAgICBfcmVtb3ZlRXZlbnRIYW5kbGVycygpIHtcbiAgICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9oYW5kbGVDaGlwQ2xpY2tCb3VuZCk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgQ2hpcHMuX2hhbmRsZUNoaXBzS2V5ZG93bik7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXl1cCcsIENoaXBzLl9oYW5kbGVDaGlwc0tleXVwKTtcbiAgICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmx1cicsIENoaXBzLl9oYW5kbGVDaGlwc0JsdXIsIHRydWUpO1xuICAgICAgdGhpcy4kaW5wdXRbMF0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9oYW5kbGVJbnB1dEZvY3VzQm91bmQpO1xuICAgICAgdGhpcy4kaW5wdXRbMF0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMuX2hhbmRsZUlucHV0Qmx1ckJvdW5kKTtcbiAgICAgIHRoaXMuJGlucHV0WzBdLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9oYW5kbGVJbnB1dEtleWRvd25Cb3VuZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIENoaXAgQ2xpY2tcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlXG4gICAgICovXG4gICAgX2hhbmRsZUNoaXBDbGljayhlKSB7XG4gICAgICBsZXQgJGNoaXAgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcuY2hpcCcpO1xuICAgICAgbGV0IGNsaWNrZWRDbG9zZSA9ICQoZS50YXJnZXQpLmlzKCcuY2xvc2UnKTtcbiAgICAgIGlmICgkY2hpcC5sZW5ndGgpIHtcbiAgICAgICAgbGV0IGluZGV4ID0gJGNoaXAuaW5kZXgoKTtcbiAgICAgICAgaWYgKGNsaWNrZWRDbG9zZSkge1xuICAgICAgICAgIC8vIGRlbGV0ZSBjaGlwXG4gICAgICAgICAgdGhpcy5kZWxldGVDaGlwKGluZGV4KTtcbiAgICAgICAgICB0aGlzLiRpbnB1dFswXS5mb2N1cygpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gc2VsZWN0IGNoaXBcbiAgICAgICAgICB0aGlzLnNlbGVjdENoaXAoaW5kZXgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGVmYXVsdCBoYW5kbGUgY2xpY2sgdG8gZm9jdXMgb24gaW5wdXRcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuJGlucHV0WzBdLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIENoaXBzIEtleWRvd25cbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlXG4gICAgICovXG4gICAgc3RhdGljIF9oYW5kbGVDaGlwc0tleWRvd24oZSkge1xuICAgICAgQ2hpcHMuX2tleWRvd24gPSB0cnVlO1xuXG4gICAgICBsZXQgJGNoaXBzID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLmNoaXBzJyk7XG4gICAgICBsZXQgY2hpcHNLZXlkb3duID0gZS50YXJnZXQgJiYgJGNoaXBzLmxlbmd0aDtcblxuICAgICAgLy8gRG9uJ3QgaGFuZGxlIGtleWRvd24gaW5wdXRzIG9uIGlucHV0IGFuZCB0ZXh0YXJlYVxuICAgICAgaWYgKCQoZS50YXJnZXQpLmlzKCdpbnB1dCwgdGV4dGFyZWEnKSB8fCAhY2hpcHNLZXlkb3duKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbGV0IGN1cnJDaGlwcyA9ICRjaGlwc1swXS5NX0NoaXBzO1xuXG4gICAgICAvLyBiYWNrc3BhY2UgYW5kIGRlbGV0ZVxuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gOCB8fCBlLmtleUNvZGUgPT09IDQ2KSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBsZXQgc2VsZWN0SW5kZXggPSBjdXJyQ2hpcHMuY2hpcHNEYXRhLmxlbmd0aDtcbiAgICAgICAgaWYgKGN1cnJDaGlwcy5fc2VsZWN0ZWRDaGlwKSB7XG4gICAgICAgICAgbGV0IGluZGV4ID0gY3VyckNoaXBzLl9zZWxlY3RlZENoaXAuaW5kZXgoKTtcbiAgICAgICAgICBjdXJyQ2hpcHMuZGVsZXRlQ2hpcChpbmRleCk7XG4gICAgICAgICAgY3VyckNoaXBzLl9zZWxlY3RlZENoaXAgPSBudWxsO1xuXG4gICAgICAgICAgLy8gTWFrZSBzdXJlIHNlbGVjdEluZGV4IGRvZXNuJ3QgZ28gbmVnYXRpdmVcbiAgICAgICAgICBzZWxlY3RJbmRleCA9IE1hdGgubWF4KGluZGV4IC0gMSwgMCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY3VyckNoaXBzLmNoaXBzRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICBjdXJyQ2hpcHMuc2VsZWN0Q2hpcChzZWxlY3RJbmRleCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBsZWZ0IGFycm93IGtleVxuICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IDM3KSB7XG4gICAgICAgIGlmIChjdXJyQ2hpcHMuX3NlbGVjdGVkQ2hpcCkge1xuICAgICAgICAgIGxldCBzZWxlY3RJbmRleCA9IGN1cnJDaGlwcy5fc2VsZWN0ZWRDaGlwLmluZGV4KCkgLSAxO1xuICAgICAgICAgIGlmIChzZWxlY3RJbmRleCA8IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3VyckNoaXBzLnNlbGVjdENoaXAoc2VsZWN0SW5kZXgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcmlnaHQgYXJyb3cga2V5XG4gICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gMzkpIHtcbiAgICAgICAgaWYgKGN1cnJDaGlwcy5fc2VsZWN0ZWRDaGlwKSB7XG4gICAgICAgICAgbGV0IHNlbGVjdEluZGV4ID0gY3VyckNoaXBzLl9zZWxlY3RlZENoaXAuaW5kZXgoKSArIDE7XG5cbiAgICAgICAgICBpZiAoc2VsZWN0SW5kZXggPj0gY3VyckNoaXBzLmNoaXBzRGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGN1cnJDaGlwcy4kaW5wdXRbMF0uZm9jdXMoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY3VyckNoaXBzLnNlbGVjdENoaXAoc2VsZWN0SW5kZXgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBDaGlwcyBLZXl1cFxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICAgKi9cbiAgICBzdGF0aWMgX2hhbmRsZUNoaXBzS2V5dXAoZSkge1xuICAgICAgQ2hpcHMuX2tleWRvd24gPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgQ2hpcHMgQmx1clxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICAgKi9cbiAgICBzdGF0aWMgX2hhbmRsZUNoaXBzQmx1cihlKSB7XG4gICAgICBpZiAoIUNoaXBzLl9rZXlkb3duKSB7XG4gICAgICAgIGxldCAkY2hpcHMgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcuY2hpcHMnKTtcbiAgICAgICAgbGV0IGN1cnJDaGlwcyA9ICRjaGlwc1swXS5NX0NoaXBzO1xuXG4gICAgICAgIGN1cnJDaGlwcy5fc2VsZWN0ZWRDaGlwID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgSW5wdXQgRm9jdXNcbiAgICAgKi9cbiAgICBfaGFuZGxlSW5wdXRGb2N1cygpIHtcbiAgICAgIHRoaXMuJGVsLmFkZENsYXNzKCdmb2N1cycpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBJbnB1dCBCbHVyXG4gICAgICovXG4gICAgX2hhbmRsZUlucHV0Qmx1cigpIHtcbiAgICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKCdmb2N1cycpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBJbnB1dCBLZXlkb3duXG4gICAgICogQHBhcmFtIHtFdmVudH0gZVxuICAgICAqL1xuICAgIF9oYW5kbGVJbnB1dEtleWRvd24oZSkge1xuICAgICAgQ2hpcHMuX2tleWRvd24gPSB0cnVlO1xuXG4gICAgICAvLyBlbnRlclxuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgICAgLy8gT3ZlcnJpZGUgZW50ZXIgaWYgYXV0b2NvbXBsZXRpbmcuXG4gICAgICAgIGlmICh0aGlzLmhhc0F1dG9jb21wbGV0ZSAmJlxuICAgICAgICAgIHRoaXMuYXV0b2NvbXBsZXRlICYmXG4gICAgICAgICAgdGhpcy5hdXRvY29tcGxldGUuaXNPcGVuKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLmFkZENoaXAoe1xuICAgICAgICAgIHRhZzogdGhpcy4kaW5wdXRbMF0udmFsdWVcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJGlucHV0WzBdLnZhbHVlID0gJyc7XG5cbiAgICAgICAgLy8gZGVsZXRlIG9yIGxlZnRcbiAgICAgIH0gZWxzZSBpZiAoKGUua2V5Q29kZSA9PT0gOCB8fCBlLmtleUNvZGUgPT09IDM3KSAmJiB0aGlzLiRpbnB1dFswXS52YWx1ZSA9PT0gJycgJiYgdGhpcy5jaGlwc0RhdGEubGVuZ3RoKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5zZWxlY3RDaGlwKHRoaXMuY2hpcHNEYXRhLmxlbmd0aCAtIDEpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbmRlciBDaGlwXG4gICAgICogQHBhcmFtIHtjaGlwfSBjaGlwXG4gICAgICogQHJldHVybiB7RWxlbWVudH1cbiAgICAgKi9cbiAgICBfcmVuZGVyQ2hpcChjaGlwKSB7XG4gICAgICBpZiAoIWNoaXAudGFnKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbGV0IHJlbmRlcmVkQ2hpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgbGV0IGNsb3NlSWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTtcbiAgICAgIHJlbmRlcmVkQ2hpcC5jbGFzc0xpc3QuYWRkKCdjaGlwJyk7XG4gICAgICByZW5kZXJlZENoaXAudGV4dENvbnRlbnQgPSBjaGlwLnRhZztcbiAgICAgIHJlbmRlcmVkQ2hpcC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgMCk7XG4gICAgICAkKGNsb3NlSWNvbikuYWRkQ2xhc3MoJ21hdGVyaWFsLWljb25zIGNsb3NlJyk7XG4gICAgICBjbG9zZUljb24udGV4dENvbnRlbnQgPSAnY2xvc2UnO1xuXG4gICAgICAvLyBhdHRhY2ggaW1hZ2UgaWYgbmVlZGVkXG4gICAgICBpZiAoY2hpcC5pbWFnZSkge1xuICAgICAgICBsZXQgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgIGltZy5zZXRBdHRyaWJ1dGUoJ3NyYycsIGNoaXAuaW1hZ2UpO1xuICAgICAgICByZW5kZXJlZENoaXAuaW5zZXJ0QmVmb3JlKGltZywgcmVuZGVyZWRDaGlwLmZpcnN0Q2hpbGQpO1xuICAgICAgfVxuXG4gICAgICByZW5kZXJlZENoaXAuYXBwZW5kQ2hpbGQoY2xvc2VJY29uKTtcbiAgICAgIHJldHVybiByZW5kZXJlZENoaXA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVuZGVyIENoaXBzXG4gICAgICovXG4gICAgX3JlbmRlckNoaXBzKCkge1xuICAgICAgdGhpcy4kY2hpcHMucmVtb3ZlKCk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY2hpcHNEYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxldCBjaGlwRWwgPSB0aGlzLl9yZW5kZXJDaGlwKHRoaXMuY2hpcHNEYXRhW2ldKTtcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKGNoaXBFbCk7XG4gICAgICAgIHRoaXMuJGNoaXBzLmFkZChjaGlwRWwpO1xuICAgICAgfVxuXG4gICAgICAvLyBtb3ZlIGlucHV0IHRvIGVuZFxuICAgICAgdGhpcy4kZWwuYXBwZW5kKHRoaXMuJGlucHV0WzBdKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXR1cCBBdXRvY29tcGxldGVcbiAgICAgKi9cbiAgICBfc2V0dXBBdXRvY29tcGxldGUoKSB7XG4gICAgICB0aGlzLm9wdGlvbnMuYXV0b2NvbXBsZXRlT3B0aW9ucy5vbkF1dG9jb21wbGV0ZSA9ICh2YWwpID0+IHtcbiAgICAgICAgdGhpcy5hZGRDaGlwKHtcbiAgICAgICAgICB0YWc6IHZhbFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy4kaW5wdXRbMF0udmFsdWUgPSAnJztcbiAgICAgICAgdGhpcy4kaW5wdXRbMF0uZm9jdXMoKTtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuYXV0b2NvbXBsZXRlID0gTS5BdXRvY29tcGxldGUuaW5pdCh0aGlzLiRpbnB1dFswXSwgdGhpcy5vcHRpb25zLmF1dG9jb21wbGV0ZU9wdGlvbnMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHVwIElucHV0XG4gICAgICovXG4gICAgX3NldHVwSW5wdXQoKSB7XG4gICAgICB0aGlzLiRpbnB1dCA9IHRoaXMuJGVsLmZpbmQoJ2lucHV0Jyk7XG4gICAgICBpZiAoIXRoaXMuJGlucHV0Lmxlbmd0aCkge1xuICAgICAgICB0aGlzLiRpbnB1dCA9ICQoJzxpbnB1dD48L2lucHV0PicpO1xuICAgICAgICB0aGlzLiRlbC5hcHBlbmQodGhpcy4kaW5wdXQpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLiRpbnB1dC5hZGRDbGFzcygnaW5wdXQnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXR1cCBMYWJlbFxuICAgICAqL1xuICAgIF9zZXR1cExhYmVsKCkge1xuICAgICAgdGhpcy4kbGFiZWwgPSB0aGlzLiRlbC5maW5kKCdsYWJlbCcpO1xuICAgICAgaWYgKHRoaXMuJGxhYmVsLmxlbmd0aCkge1xuICAgICAgICB0aGlzLiRsYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsIHRoaXMuJGlucHV0LmF0dHIoJ2lkJykpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCBwbGFjZWhvbGRlclxuICAgICAqL1xuICAgIF9zZXRQbGFjZWhvbGRlcigpIHtcbiAgICAgIGlmICgodGhpcy5jaGlwc0RhdGEgIT09IHVuZGVmaW5lZCAmJiAhdGhpcy5jaGlwc0RhdGEubGVuZ3RoKSAmJiB0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIpIHtcbiAgICAgICAgJCh0aGlzLiRpbnB1dCkucHJvcCgncGxhY2Vob2xkZXInLCB0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIpO1xuXG4gICAgICB9IGVsc2UgaWYgKCh0aGlzLmNoaXBzRGF0YSA9PT0gdW5kZWZpbmVkIHx8ICEhdGhpcy5jaGlwc0RhdGEubGVuZ3RoKSAmJiB0aGlzLm9wdGlvbnMuc2Vjb25kYXJ5UGxhY2Vob2xkZXIpIHtcbiAgICAgICAgJCh0aGlzLiRpbnB1dCkucHJvcCgncGxhY2Vob2xkZXInLCB0aGlzLm9wdGlvbnMuc2Vjb25kYXJ5UGxhY2Vob2xkZXIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIGNoaXAgaXMgdmFsaWRcbiAgICAgKiBAcGFyYW0ge2NoaXB9IGNoaXBcbiAgICAgKi9cbiAgICBfaXNWYWxpZChjaGlwKSB7XG4gICAgICBpZiAoY2hpcC5oYXNPd25Qcm9wZXJ0eSgndGFnJykgJiYgY2hpcC50YWcgIT09ICcnKSB7XG4gICAgICAgIGxldCBleGlzdHMgPSBmYWxzZTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNoaXBzRGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmICh0aGlzLmNoaXBzRGF0YVtpXS50YWcgPT09IGNoaXAudGFnKSB7XG4gICAgICAgICAgICBleGlzdHMgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhZXhpc3RzO1xuXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgY2hpcFxuICAgICAqIEBwYXJhbSB7Y2hpcH0gY2hpcFxuICAgICAqL1xuICAgIGFkZENoaXAoY2hpcCkge1xuICAgICAgaWYgKCF0aGlzLl9pc1ZhbGlkKGNoaXApIHx8XG4gICAgICAgIHRoaXMuY2hpcHNEYXRhLmxlbmd0aCA+PSB0aGlzLm9wdGlvbnMubGltaXQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBsZXQgcmVuZGVyZWRDaGlwID0gdGhpcy5fcmVuZGVyQ2hpcChjaGlwKTtcbiAgICAgIHRoaXMuJGNoaXBzLmFkZChyZW5kZXJlZENoaXApO1xuICAgICAgdGhpcy5jaGlwc0RhdGEucHVzaChjaGlwKTtcbiAgICAgICQodGhpcy4kaW5wdXQpLmJlZm9yZShyZW5kZXJlZENoaXApO1xuICAgICAgdGhpcy5fc2V0UGxhY2Vob2xkZXIoKTtcblxuICAgICAgLy8gZmlyZSBjaGlwQWRkIGNhbGxiYWNrXG4gICAgICBpZiAodHlwZW9mICh0aGlzLm9wdGlvbnMub25DaGlwQWRkKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aGlzLm9wdGlvbnMub25DaGlwQWRkLmNhbGwodGhpcywgdGhpcy4kZWwsIHJlbmRlcmVkQ2hpcCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlIGNoaXBcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gY2hpcFxuICAgICAqL1xuICAgIGRlbGV0ZUNoaXAoY2hpcEluZGV4KSB7XG4gICAgICBsZXQgJGNoaXAgPSB0aGlzLiRjaGlwcy5lcShjaGlwSW5kZXgpO1xuICAgICAgdGhpcy4kY2hpcHMuZXEoY2hpcEluZGV4KS5yZW1vdmUoKTtcbiAgICAgIHRoaXMuJGNoaXBzID0gdGhpcy4kY2hpcHMuZmlsdGVyKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICByZXR1cm4gJChlbCkuaW5kZXgoKSA+PSAwO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNoaXBzRGF0YS5zcGxpY2UoY2hpcEluZGV4LCAxKTtcbiAgICAgIHRoaXMuX3NldFBsYWNlaG9sZGVyKCk7XG5cbiAgICAgIC8vIGZpcmUgY2hpcERlbGV0ZSBjYWxsYmFja1xuICAgICAgaWYgKHR5cGVvZiAodGhpcy5vcHRpb25zLm9uQ2hpcERlbGV0ZSkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLm9uQ2hpcERlbGV0ZS5jYWxsKHRoaXMsIHRoaXMuJGVsLCAkY2hpcFswXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VsZWN0IGNoaXBcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gY2hpcFxuICAgICAqL1xuICAgIHNlbGVjdENoaXAoY2hpcEluZGV4KSB7XG4gICAgICBsZXQgJGNoaXAgPSB0aGlzLiRjaGlwcy5lcShjaGlwSW5kZXgpO1xuICAgICAgdGhpcy5fc2VsZWN0ZWRDaGlwID0gJGNoaXA7XG4gICAgICAkY2hpcFswXS5mb2N1cygpO1xuXG4gICAgICAvLyBmaXJlIGNoaXBTZWxlY3QgY2FsbGJhY2tcbiAgICAgIGlmICh0eXBlb2YgKHRoaXMub3B0aW9ucy5vbkNoaXBTZWxlY3QpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5vbkNoaXBTZWxlY3QuY2FsbCh0aGlzLCB0aGlzLiRlbCwgJGNoaXBbMF0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZW1iZXJvZiBDaGlwc1xuICAgKi9cbiAgQ2hpcHMuX2tleWRvd24gPSBmYWxzZTtcblxuICBNLkNoaXBzID0gQ2hpcHM7XG5cbiAgaWYgKE0ualF1ZXJ5TG9hZGVkKSB7XG4gICAgTS5pbml0aWFsaXplSnF1ZXJ5V3JhcHBlcihDaGlwcywgJ2NoaXBzJywgJ01fQ2hpcHMnKTtcbiAgfVxuXG4gICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAvLyBIYW5kbGUgcmVtb3ZhbCBvZiBzdGF0aWMgY2hpcHMuXG4gICAgJChkb2N1bWVudC5ib2R5KS5vbignY2xpY2snLCAnLmNoaXAgLmNsb3NlJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0ICRjaGlwcyA9ICQodGhpcykuY2xvc2VzdCgnLmNoaXBzJyk7XG4gICAgICBpZiAoJGNoaXBzLmxlbmd0aCAmJiAkY2hpcHNbMF0uTV9DaGlwcykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAkKHRoaXMpLmNsb3Nlc3QoJy5jaGlwJykucmVtb3ZlKCk7XG4gICAgfSk7XG4gIH0pO1xufShjYXNoKSk7XG4iXX0=
