"use strict";var _createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),_get=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,n,o)}if("value"in i)return i.value;var l=i.get;return void 0!==l?l.call(o):void 0};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}!function(i,n){var t={opacity:.5,inDuration:250,outDuration:250,onOpenStart:null,onOpenEnd:null,onCloseStart:null,onCloseEnd:null,preventScrolling:!0,dismissible:!0,startingTop:"4%",endingTop:"10%"},e=function(e){function o(e,t){_classCallCheck(this,o);var n=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,o,e,t));return(n.el.M_Modal=n).options=i.extend({},o.defaults,t),n.isOpen=!1,n.id=n.$el.attr("id"),n._openingTrigger=void 0,n.$overlay=i('<div class="modal-overlay"></div>'),n.el.tabIndex=0,o._count++,n._setupEventHandlers(),n}return _inherits(o,Component),_createClass(o,[{key:"destroy",value:function(){o._count--,this._removeEventHandlers(),this.el.removeAttribute("style"),this.$overlay.remove(),this.el.M_Modal=void 0}},{key:"_setupEventHandlers",value:function(){this._handleOverlayClickBound=this._handleOverlayClick.bind(this),this._handleModalCloseClickBound=this._handleModalCloseClick.bind(this),1===o._count&&document.body.addEventListener("click",this._handleTriggerClick),this.$overlay[0].addEventListener("click",this._handleOverlayClickBound),this.el.addEventListener("click",this._handleModalCloseClickBound)}},{key:"_removeEventHandlers",value:function(){0===o._count&&document.body.removeEventListener("click",this._handleTriggerClick),this.$overlay[0].removeEventListener("click",this._handleOverlayClickBound),this.el.removeEventListener("click",this._handleModalCloseClickBound)}},{key:"_handleTriggerClick",value:function(e){var t=i(e.target).closest(".modal-trigger");if(t.length){var n=M.getIdFromTrigger(t[0]),o=document.getElementById(n).M_Modal;o&&o.open(t),e.preventDefault()}}},{key:"_handleOverlayClick",value:function(){this.options.dismissible&&this.close()}},{key:"_handleModalCloseClick",value:function(e){i(e.target).closest(".modal-close").length&&this.close()}},{key:"_handleKeydown",value:function(e){27===e.keyCode&&this.options.dismissible&&this.close()}},{key:"_handleFocus",value:function(e){this.el.contains(e.target)||this.el.focus()}},{key:"_animateIn",value:function(){var e=this;i.extend(this.el.style,{display:"block",opacity:0}),i.extend(this.$overlay[0].style,{display:"block",opacity:0}),n({targets:this.$overlay[0],opacity:this.options.opacity,duration:this.options.inDuration,easing:"easeOutQuad"});var t={targets:this.el,duration:this.options.inDuration,easing:"easeOutCubic",complete:function(){"function"==typeof e.options.onOpenEnd&&e.options.onOpenEnd.call(e,e.el,e._openingTrigger)}};this.el.classList.contains("bottom-sheet")?i.extend(t,{bottom:0,opacity:1}):i.extend(t,{top:[this.options.startingTop,this.options.endingTop],opacity:1,scaleX:[.8,1],scaleY:[.8,1]}),n(t)}},{key:"_animateOut",value:function(){var e=this;n({targets:this.$overlay[0],opacity:0,duration:this.options.outDuration,easing:"easeOutQuart"});var t={targets:this.el,duration:this.options.outDuration,easing:"easeOutCubic",complete:function(){e.el.style.display="none",e.$overlay.remove(),"function"==typeof e.options.onCloseEnd&&e.options.onCloseEnd.call(e,e.el)}};this.el.classList.contains("bottom-sheet")?i.extend(t,{bottom:"-100%",opacity:0}):i.extend(t,{top:[this.options.endingTop,this.options.startingTop],opacity:0,scaleX:.8,scaleY:.8}),n(t)}},{key:"open",value:function(e){if(!this.isOpen)return this.isOpen=!0,o._modalsOpen++,this.$overlay[0].style.zIndex=1e3+2*o._modalsOpen,this.el.style.zIndex=1e3+2*o._modalsOpen+1,this._openingTrigger=e?e[0]:void 0,"function"==typeof this.options.onOpenStart&&this.options.onOpenStart.call(this,this.el,this._openingTrigger),this.options.preventScrolling&&(document.body.style.overflow="hidden"),this.el.classList.add("open"),this.el.insertAdjacentElement("afterend",this.$overlay[0]),this.options.dismissible&&(this._handleKeydownBound=this._handleKeydown.bind(this),this._handleFocusBound=this._handleFocus.bind(this),document.addEventListener("keydown",this._handleKeydownBound),document.addEventListener("focus",this._handleFocusBound,!0)),n.remove(this.el),n.remove(this.$overlay[0]),this._animateIn(),this.el.focus(),this}},{key:"close",value:function(){if(this.isOpen)return this.isOpen=!1,o._modalsOpen--,"function"==typeof this.options.onCloseStart&&this.options.onCloseStart.call(this,this.el),this.el.classList.remove("open"),0===o._modalsOpen&&(document.body.style.overflow=""),this.options.dismissible&&(document.removeEventListener("keydown",this._handleKeydownBound),document.removeEventListener("focus",this._handleFocusBound)),n.remove(this.el),n.remove(this.$overlay[0]),this._animateOut(),this}}],[{key:"init",value:function(e,t){return _get(o.__proto__||Object.getPrototypeOf(o),"init",this).call(this,this,e,t)}},{key:"getInstance",value:function(e){return(e.jquery?e[0]:e).M_Modal}},{key:"defaults",get:function(){return t}}]),o}();e._modalsOpen=0,e._count=0,M.Modal=e,M.jQueryLoaded&&M.initializeJqueryWrapper(e,"modal","M_Modal")}(cash,M.anime);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZGFsLmpzIl0sIm5hbWVzIjpbIiQiLCJhbmltIiwiX2RlZmF1bHRzIiwib3BhY2l0eSIsImluRHVyYXRpb24iLCJvdXREdXJhdGlvbiIsIm9uT3BlblN0YXJ0Iiwib25PcGVuRW5kIiwib25DbG9zZVN0YXJ0Iiwib25DbG9zZUVuZCIsInByZXZlbnRTY3JvbGxpbmciLCJkaXNtaXNzaWJsZSIsInN0YXJ0aW5nVG9wIiwiZW5kaW5nVG9wIiwiX0NvbXBvbmVudCIsIk1vZGFsIiwiZWwiLCJvcHRpb25zIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsIl90aGlzIiwiX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4iLCJfX3Byb3RvX18iLCJPYmplY3QiLCJnZXRQcm90b3R5cGVPZiIsImNhbGwiLCJNX01vZGFsIiwiZXh0ZW5kIiwiZGVmYXVsdHMiLCJpc09wZW4iLCJpZCIsIiRlbCIsImF0dHIiLCJfb3BlbmluZ1RyaWdnZXIiLCJ1bmRlZmluZWQiLCIkb3ZlcmxheSIsInRhYkluZGV4IiwiX2NvdW50IiwiX3NldHVwRXZlbnRIYW5kbGVycyIsIl9pbmhlcml0cyIsIkNvbXBvbmVudCIsIl9jcmVhdGVDbGFzcyIsImtleSIsInZhbHVlIiwiX3JlbW92ZUV2ZW50SGFuZGxlcnMiLCJyZW1vdmVBdHRyaWJ1dGUiLCJyZW1vdmUiLCJfaGFuZGxlT3ZlcmxheUNsaWNrQm91bmQiLCJfaGFuZGxlT3ZlcmxheUNsaWNrIiwiYmluZCIsIl9oYW5kbGVNb2RhbENsb3NlQ2xpY2tCb3VuZCIsIl9oYW5kbGVNb2RhbENsb3NlQ2xpY2siLCJkb2N1bWVudCIsImJvZHkiLCJhZGRFdmVudExpc3RlbmVyIiwiX2hhbmRsZVRyaWdnZXJDbGljayIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJlIiwiJHRyaWdnZXIiLCJsZW5ndGgiLCJtb2RhbElkIiwiTSIsImdldElkRnJvbVRyaWdnZXIiLCJtb2RhbEluc3RhbmNlIiwiZ2V0RWxlbWVudEJ5SWQiLCJvcGVuIiwicHJldmVudERlZmF1bHQiLCJjbG9zZSIsInRhcmdldCIsImNsb3Nlc3QiLCJrZXlDb2RlIiwiJGNsb3NlVHJpZ2dlciIsImZvY3VzIiwiX3RoaXMyIiwic3R5bGUiLCJkaXNwbGF5IiwidGFyZ2V0cyIsImR1cmF0aW9uIiwiZWFzaW5nIiwiZW50ZXJBbmltT3B0aW9ucyIsImNvbXBsZXRlIiwiY2xhc3NMaXN0IiwiX3RoaXMzIiwiYm90dG9tIiwic2NhbGVYIiwiY29udGFpbnMiLCJleGl0QW5pbU9wdGlvbnMiLCJ0b3AiLCJfbW9kYWxzT3BlbiIsInpJbmRleCIsImFkZCIsInNjYWxlWSIsIl9oYW5kbGVLZXlkb3duQm91bmQiLCJfaGFuZGxlS2V5ZG93biIsIl9oYW5kbGVGb2N1c0JvdW5kIiwiX2hhbmRsZUZvY3VzIiwiX2FuaW1hdGVJbiIsImluc2VydEFkamFjZW50RWxlbWVudCIsIm92ZXJmbG93IiwiX2FuaW1hdGVPdXQiLCJlbHMiLCJfZ2V0IiwianF1ZXJ5IiwiZ2V0IiwialF1ZXJ5TG9hZGVkIiwiY2FzaCIsImFuaW1lIl0sIm1hcHBpbmdzIjoiNG5DQUFBLFNBQVVBLEVBQUdDLEdBR1gsSUFBSUMsRUFBWSxDQUNkQyxRQUFTLEdBQ1RDLFdBQVksSUFDWkMsWUFBYSxJQUNiQyxZQUFhLEtBQ2JDLFVBQVcsS0FDWEMsYUFBYyxLQUNkQyxXQUFZLEtBQ1pDLGtCQUFrQixFQVhyQkMsYUFBWVYsRUFDWFcsWUFBQSxLQWFFQyxVQUFXLE9BSlhKLEVBVmUsU0FBQUssR0FrQmpCLFNBQUFDLEVBQUFDLEVBQUFDLEdBQUFDLGdCQUFBQyxLQUFBSixHQUFBLElBQUFLLEVBQUFDLDJCQUFBRixNQUFBSixFQUFBTyxXQUFBQyxPQUFBQyxlQUFBVCxJQUFBVSxLQUFBTixLQVlVSixFQUFPQyxFQUFJQyxJQVpyQixPQWNJRyxFQUFLSixHQUFHVSxRQUFSTixHQUFBSCxRQUFRUyxFQUFSQyxPQUFBLEdBQUFaLEVBQUFhLFNBQUFYLEdBc0JBRyxFQUFLUyxRQUFTLEVBRWRULEVBQUtVLEdBQUtWLEVBQUtXLElBQUlD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U0FBQUEsb0JBQTBCLFFBQVNqQyxLQUFLMkUsb0JBRzFDN0YsRUFBQUEsT0FBSzZDLEtBQU85QixJQUNaZixFQUFBQSxPQUFLNkMsS0FBT1gsU0FBS0EsSUFDakJoQixLQUFBZ0YsY0F1Q09oRixRQXRXTSxDQUFBLENBQUF1QixJQUFBLE9BQUFDLE1BQUEsU0FxRUh5RCxFQUFLbkYsR0FmZixPQUFBb0YsS0FBQXRGLEVBQUFPLFdBQUFDLE9BQUFDLGVBQUFULEdBQUEsT0FBQUksTUFBQU0sS0FBQU4sS0FBY0EsS0FBZGlGLEVBQUFuRixLQXREYSxDQUFBeUIsSUFBQSxjQUFBQyxNQUFBLFNBNEVJM0IsR0FkakIsT0FEQUEsRUFBQXNGLE9BQUF0RixFQUFBLEdBQUFBLEdBQ0tzQixVQTlEUSxDQUFBSSxJQUFBLFdBQUE2RCxJQUFBLFdBa0RiLE9BQUFyRyxNQWxEYWEsRUFBQSxHQThXakJBLEVBQU15RSxZQUFjLEVBbkNoQnpFLEVBQUFzQixPQUFLLEVBRUp3QixFQUFBOUMsTUFBQUEsRUFFRDhDLEVBQUEyQyxjQUNBekYsRUFBQUEsd0JBQUFBLEVBQUEsUUFBQSxXQWhWTixDQW1WTTBGLEtBQUE1QyxFQUFBNkMiLCJmaWxlIjoibW9kYWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oJCwgYW5pbSkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgbGV0IF9kZWZhdWx0cyA9IHtcbiAgICBvcGFjaXR5OiAwLjUsXG4gICAgaW5EdXJhdGlvbjogMjUwLFxuICAgIG91dER1cmF0aW9uOiAyNTAsXG4gICAgb25PcGVuU3RhcnQ6IG51bGwsXG4gICAgb25PcGVuRW5kOiBudWxsLFxuICAgIG9uQ2xvc2VTdGFydDogbnVsbCxcbiAgICBvbkNsb3NlRW5kOiBudWxsLFxuICAgIHByZXZlbnRTY3JvbGxpbmc6IHRydWUsXG4gICAgZGlzbWlzc2libGU6IHRydWUsXG4gICAgc3RhcnRpbmdUb3A6ICc0JScsXG4gICAgZW5kaW5nVG9wOiAnMTAlJ1xuICB9O1xuXG5cbiAgLyoqXG4gICAqIEBjbGFzc1xuICAgKlxuICAgKi9cbiAgY2xhc3MgTW9kYWwgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdCBNb2RhbCBpbnN0YW5jZSBhbmQgc2V0IHVwIG92ZXJsYXlcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlbCwgb3B0aW9ucykge1xuICAgICAgc3VwZXIoTW9kYWwsIGVsLCBvcHRpb25zKTtcblxuICAgICAgdGhpcy5lbC5NX01vZGFsID0gdGhpcztcblxuICAgICAgLyoqXG4gICAgICAgKiBPcHRpb25zIGZvciB0aGUgbW9kYWxcbiAgICAgICAqIEBtZW1iZXIgTW9kYWwjb3B0aW9uc1xuICAgICAgICogQHByb3Age051bWJlcn0gW29wYWNpdHk9MC41XSAtIE9wYWNpdHkgb2YgdGhlIG1vZGFsIG92ZXJsYXlcbiAgICAgICAqIEBwcm9wIHtOdW1iZXJ9IFtpbkR1cmF0aW9uPTI1MF0gLSBMZW5ndGggaW4gbXMgb2YgZW50ZXIgdHJhbnNpdGlvblxuICAgICAgICogQHByb3Age051bWJlcn0gW291dER1cmF0aW9uPTI1MF0gLSBMZW5ndGggaW4gbXMgb2YgZXhpdCB0cmFuc2l0aW9uXG4gICAgICAgKiBAcHJvcCB7RnVuY3Rpb259IG9uT3BlblN0YXJ0IC0gQ2FsbGJhY2sgZnVuY3Rpb24gY2FsbGVkIGJlZm9yZSBtb2RhbCBpcyBvcGVuZWRcbiAgICAgICAqIEBwcm9wIHtGdW5jdGlvbn0gb25PcGVuRW5kIC0gQ2FsbGJhY2sgZnVuY3Rpb24gY2FsbGVkIGFmdGVyIG1vZGFsIGlzIG9wZW5lZFxuICAgICAgICogQHByb3Age0Z1bmN0aW9ufSBvbkNsb3NlU3RhcnQgLSBDYWxsYmFjayBmdW5jdGlvbiBjYWxsZWQgYmVmb3JlIG1vZGFsIGlzIGNsb3NlZFxuICAgICAgICogQHByb3Age0Z1bmN0aW9ufSBvbkNsb3NlRW5kIC0gQ2FsbGJhY2sgZnVuY3Rpb24gY2FsbGVkIGFmdGVyIG1vZGFsIGlzIGNsb3NlZFxuICAgICAgICogQHByb3Age0Jvb2xlYW59IFtkaXNtaXNzaWJsZT10cnVlXSAtIEFsbG93IG1vZGFsIHRvIGJlIGRpc21pc3NlZCBieSBrZXlib2FyZCBvciBvdmVybGF5IGNsaWNrXG4gICAgICAgKiBAcHJvcCB7U3RyaW5nfSBbc3RhcnRpbmdUb3A9JzQlJ10gLSBzdGFydGluZ1RvcFxuICAgICAgICogQHByb3Age1N0cmluZ30gW2VuZGluZ1RvcD0nMTAlJ10gLSBlbmRpbmdUb3BcbiAgICAgICAqL1xuICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIE1vZGFsLmRlZmF1bHRzLCBvcHRpb25zKTtcblxuICAgICAgLyoqXG4gICAgICAgKiBEZXNjcmliZXMgb3Blbi9jbG9zZSBzdGF0ZSBvZiBtb2RhbFxuICAgICAgICogQHR5cGUge0Jvb2xlYW59XG4gICAgICAgKi9cbiAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7XG5cbiAgICAgIHRoaXMuaWQgPSB0aGlzLiRlbC5hdHRyKCdpZCcpO1xuICAgICAgdGhpcy5fb3BlbmluZ1RyaWdnZXIgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLiRvdmVybGF5ID0gJCgnPGRpdiBjbGFzcz1cIm1vZGFsLW92ZXJsYXlcIj48L2Rpdj4nKTtcbiAgICAgIHRoaXMuZWwudGFiSW5kZXggPSAwO1xuXG4gICAgICBNb2RhbC5fY291bnQrKztcbiAgICAgIHRoaXMuX3NldHVwRXZlbnRIYW5kbGVycygpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgZGVmYXVsdHMoKSB7XG4gICAgICByZXR1cm4gX2RlZmF1bHRzO1xuICAgIH1cblxuICAgIHN0YXRpYyBpbml0KGVscywgb3B0aW9ucykge1xuICAgICAgcmV0dXJuIHN1cGVyLmluaXQodGhpcywgZWxzLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgSW5zdGFuY2VcbiAgICAgKi9cbiAgICBzdGF0aWMgZ2V0SW5zdGFuY2UoZWwpIHtcbiAgICAgIGxldCBkb21FbGVtID0gISFlbC5qcXVlcnkgPyBlbFswXSA6IGVsO1xuICAgICAgcmV0dXJuIGRvbUVsZW0uTV9Nb2RhbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZWFyZG93biBjb21wb25lbnRcbiAgICAgKi9cbiAgICBkZXN0cm95KCkge1xuICAgICAgTW9kYWwuX2NvdW50LS07XG4gICAgICB0aGlzLl9yZW1vdmVFdmVudEhhbmRsZXJzKCk7XG4gICAgICB0aGlzLmVsLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTtcbiAgICAgIHRoaXMuJG92ZXJsYXkucmVtb3ZlKCk7XG4gICAgICB0aGlzLmVsLk1fTW9kYWwgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0dXAgRXZlbnQgSGFuZGxlcnNcbiAgICAgKi9cbiAgICBfc2V0dXBFdmVudEhhbmRsZXJzKCkge1xuICAgICAgdGhpcy5faGFuZGxlT3ZlcmxheUNsaWNrQm91bmQgPSB0aGlzLl9oYW5kbGVPdmVybGF5Q2xpY2suYmluZCh0aGlzKTtcbiAgICAgIHRoaXMuX2hhbmRsZU1vZGFsQ2xvc2VDbGlja0JvdW5kID0gdGhpcy5faGFuZGxlTW9kYWxDbG9zZUNsaWNrLmJpbmQodGhpcyk7XG5cbiAgICAgIGlmIChNb2RhbC5fY291bnQgPT09IDEpIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2hhbmRsZVRyaWdnZXJDbGljayk7XG4gICAgICB9XG4gICAgICB0aGlzLiRvdmVybGF5WzBdLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5faGFuZGxlT3ZlcmxheUNsaWNrQm91bmQpO1xuICAgICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2hhbmRsZU1vZGFsQ2xvc2VDbGlja0JvdW5kKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgRXZlbnQgSGFuZGxlcnNcbiAgICAgKi9cbiAgICBfcmVtb3ZlRXZlbnRIYW5kbGVycygpIHtcbiAgICAgIGlmIChNb2RhbC5fY291bnQgPT09IDApIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2hhbmRsZVRyaWdnZXJDbGljayk7XG4gICAgICB9XG4gICAgICB0aGlzLiRvdmVybGF5WzBdLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5faGFuZGxlT3ZlcmxheUNsaWNrQm91bmQpO1xuICAgICAgdGhpcy5lbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2hhbmRsZU1vZGFsQ2xvc2VDbGlja0JvdW5kKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgVHJpZ2dlciBDbGlja1xuICAgICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICAgKi9cbiAgICBfaGFuZGxlVHJpZ2dlckNsaWNrKGUpIHtcbiAgICAgIGxldCAkdHJpZ2dlciA9ICAkKGUudGFyZ2V0KS5jbG9zZXN0KCcubW9kYWwtdHJpZ2dlcicpO1xuICAgICAgaWYgKCR0cmlnZ2VyLmxlbmd0aCkge1xuICAgICAgICBsZXQgbW9kYWxJZCA9IE0uZ2V0SWRGcm9tVHJpZ2dlcigkdHJpZ2dlclswXSk7XG4gICAgICAgIGxldCBtb2RhbEluc3RhbmNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9kYWxJZCkuTV9Nb2RhbDtcbiAgICAgICAgaWYgKG1vZGFsSW5zdGFuY2UpIHtcbiAgICAgICAgICBtb2RhbEluc3RhbmNlLm9wZW4oJHRyaWdnZXIpO1xuICAgICAgICB9XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgT3ZlcmxheSBDbGlja1xuICAgICAqL1xuICAgIF9oYW5kbGVPdmVybGF5Q2xpY2soKSB7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmRpc21pc3NpYmxlKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgTW9kYWwgQ2xvc2UgQ2xpY2tcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlXG4gICAgICovXG4gICAgX2hhbmRsZU1vZGFsQ2xvc2VDbGljayhlKSB7XG4gICAgICBsZXQgJGNsb3NlVHJpZ2dlciA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5tb2RhbC1jbG9zZScpO1xuICAgICAgaWYgKCRjbG9zZVRyaWdnZXIubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgS2V5ZG93blxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICAgKi9cbiAgICBfaGFuZGxlS2V5ZG93bihlKSB7XG4gICAgICAvLyBFU0Mga2V5XG4gICAgICBpZiAoZS5rZXlDb2RlID09PSAyNyAmJiB0aGlzLm9wdGlvbnMuZGlzbWlzc2libGUpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBGb2N1c1xuICAgICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICAgKi9cbiAgICBfaGFuZGxlRm9jdXMoZSkge1xuICAgICAgaWYgKCF0aGlzLmVsLmNvbnRhaW5zKGUudGFyZ2V0KSkge1xuICAgICAgICB0aGlzLmVsLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQW5pbWF0ZSBpbiBtb2RhbFxuICAgICAqL1xuICAgIF9hbmltYXRlSW4oKSB7XG4gICAgICAvLyBTZXQgaW5pdGlhbCBzdHlsZXNcbiAgICAgICQuZXh0ZW5kKHRoaXMuZWwuc3R5bGUsIHtcbiAgICAgICAgZGlzcGxheTogJ2Jsb2NrJyxcbiAgICAgICAgb3BhY2l0eTogMFxuICAgICAgfSk7XG4gICAgICAkLmV4dGVuZCh0aGlzLiRvdmVybGF5WzBdLnN0eWxlLCB7XG4gICAgICAgIGRpc3BsYXk6ICdibG9jaycsXG4gICAgICAgIG9wYWNpdHk6IDBcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBbmltYXRlIG92ZXJsYXlcbiAgICAgIGFuaW0oe1xuICAgICAgICB0YXJnZXRzOiB0aGlzLiRvdmVybGF5WzBdLFxuICAgICAgICBvcGFjaXR5OiB0aGlzLm9wdGlvbnMub3BhY2l0eSxcbiAgICAgICAgZHVyYXRpb246IHRoaXMub3B0aW9ucy5pbkR1cmF0aW9uLFxuICAgICAgICBlYXNpbmc6ICdlYXNlT3V0UXVhZCdcbiAgICAgIH0pO1xuXG4gICAgICAvLyBEZWZpbmUgbW9kYWwgYW5pbWF0aW9uIG9wdGlvbnNcbiAgICAgIGxldCBlbnRlckFuaW1PcHRpb25zID0ge1xuICAgICAgICB0YXJnZXRzOiB0aGlzLmVsLFxuICAgICAgICBkdXJhdGlvbjogdGhpcy5vcHRpb25zLmluRHVyYXRpb24sXG4gICAgICAgIGVhc2luZzogJ2Vhc2VPdXRDdWJpYycsXG4gICAgICAgIC8vIEhhbmRsZSBtb2RhbCBvbk9wZW5FbmQgY2FsbGJhY2tcbiAgICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgICBpZiAodHlwZW9mKHRoaXMub3B0aW9ucy5vbk9wZW5FbmQpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMub25PcGVuRW5kLmNhbGwodGhpcywgdGhpcy5lbCwgdGhpcy5fb3BlbmluZ1RyaWdnZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLy8gQm90dG9tIHNoZWV0IGFuaW1hdGlvblxuICAgICAgaWYgKHRoaXMuZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdib3R0b20tc2hlZXQnKSkge1xuICAgICAgICAkLmV4dGVuZChlbnRlckFuaW1PcHRpb25zLCB7XG4gICAgICAgICAgYm90dG9tOiAwLFxuICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgfSk7XG4gICAgICAgIGFuaW0oZW50ZXJBbmltT3B0aW9ucyk7XG5cbiAgICAgIC8vIE5vcm1hbCBtb2RhbCBhbmltYXRpb25cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICQuZXh0ZW5kKGVudGVyQW5pbU9wdGlvbnMsIHtcbiAgICAgICAgICB0b3A6IFt0aGlzLm9wdGlvbnMuc3RhcnRpbmdUb3AsIHRoaXMub3B0aW9ucy5lbmRpbmdUb3BdLFxuICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgc2NhbGVYOiBbLjgsIDFdLFxuICAgICAgICAgIHNjYWxlWTogWy44LCAxXVxuICAgICAgICB9KTtcbiAgICAgICAgYW5pbShlbnRlckFuaW1PcHRpb25zKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBbmltYXRlIG91dCBtb2RhbFxuICAgICAqL1xuICAgIF9hbmltYXRlT3V0KCkge1xuICAgICAgLy8gQW5pbWF0ZSBvdmVybGF5XG4gICAgICBhbmltKHtcbiAgICAgICAgdGFyZ2V0czogdGhpcy4kb3ZlcmxheVswXSxcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgZHVyYXRpb246IHRoaXMub3B0aW9ucy5vdXREdXJhdGlvbixcbiAgICAgICAgZWFzaW5nOiAnZWFzZU91dFF1YXJ0J1xuICAgICAgfSk7XG5cbiAgICAgIC8vIERlZmluZSBtb2RhbCBhbmltYXRpb24gb3B0aW9uc1xuICAgICAgbGV0IGV4aXRBbmltT3B0aW9ucyA9IHtcbiAgICAgICAgdGFyZ2V0czogdGhpcy5lbCxcbiAgICAgICAgZHVyYXRpb246IHRoaXMub3B0aW9ucy5vdXREdXJhdGlvbixcbiAgICAgICAgZWFzaW5nOiAnZWFzZU91dEN1YmljJyxcbiAgICAgICAgLy8gSGFuZGxlIG1vZGFsIHJlYWR5IGNhbGxiYWNrXG4gICAgICAgIGNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgIHRoaXMuJG92ZXJsYXkucmVtb3ZlKCk7XG5cbiAgICAgICAgICAvLyBDYWxsIG9uQ2xvc2VFbmQgY2FsbGJhY2tcbiAgICAgICAgICBpZiAodHlwZW9mKHRoaXMub3B0aW9ucy5vbkNsb3NlRW5kKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm9uQ2xvc2VFbmQuY2FsbCh0aGlzLCB0aGlzLmVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIEJvdHRvbSBzaGVldCBhbmltYXRpb25cbiAgICAgIGlmICh0aGlzLmVsLmNsYXNzTGlzdC5jb250YWlucygnYm90dG9tLXNoZWV0JykpIHtcbiAgICAgICAgJC5leHRlbmQoZXhpdEFuaW1PcHRpb25zLCB7XG4gICAgICAgICAgYm90dG9tOiAnLTEwMCUnLFxuICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgfSk7XG4gICAgICAgIGFuaW0oZXhpdEFuaW1PcHRpb25zKTtcblxuICAgICAgLy8gTm9ybWFsIG1vZGFsIGFuaW1hdGlvblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJC5leHRlbmQoZXhpdEFuaW1PcHRpb25zLCB7XG4gICAgICAgICAgdG9wOiBbdGhpcy5vcHRpb25zLmVuZGluZ1RvcCwgdGhpcy5vcHRpb25zLnN0YXJ0aW5nVG9wXSxcbiAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgIHNjYWxlWDogMC44LFxuICAgICAgICAgIHNjYWxlWTogMC44XG4gICAgICAgIH0pO1xuICAgICAgICBhbmltKGV4aXRBbmltT3B0aW9ucyk7XG4gICAgICB9XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBPcGVuIE1vZGFsXG4gICAgICogQHBhcmFtIHtjYXNofSBbJHRyaWdnZXJdXG4gICAgICovXG4gICAgb3BlbigkdHJpZ2dlcikge1xuICAgICAgaWYgKHRoaXMuaXNPcGVuKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xuICAgICAgTW9kYWwuX21vZGFsc09wZW4rKztcblxuICAgICAgLy8gU2V0IFotSW5kZXggYmFzZWQgb24gbnVtYmVyIG9mIGN1cnJlbnRseSBvcGVuIG1vZGFsc1xuICAgICAgdGhpcy4kb3ZlcmxheVswXS5zdHlsZS56SW5kZXggPSAxMDAwICsgTW9kYWwuX21vZGFsc09wZW4gKiAyO1xuICAgICAgdGhpcy5lbC5zdHlsZS56SW5kZXggPSAxMDAwICsgTW9kYWwuX21vZGFsc09wZW4gKiAyICsgMTtcblxuICAgICAgLy8gU2V0IG9wZW5pbmcgdHJpZ2dlciwgdW5kZWZpbmVkIGluZGljYXRlcyBtb2RhbCB3YXMgb3BlbmVkIGJ5IGphdmFzY3JpcHRcbiAgICAgIHRoaXMuX29wZW5pbmdUcmlnZ2VyID0gISEkdHJpZ2dlciA/ICR0cmlnZ2VyWzBdIDogdW5kZWZpbmVkO1xuXG4gICAgICAvLyBvbk9wZW5TdGFydCBjYWxsYmFja1xuICAgICAgaWYgKHR5cGVvZih0aGlzLm9wdGlvbnMub25PcGVuU3RhcnQpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5vbk9wZW5TdGFydC5jYWxsKHRoaXMsIHRoaXMuZWwsIHRoaXMuX29wZW5pbmdUcmlnZ2VyKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5wcmV2ZW50U2Nyb2xsaW5nKSB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJztcbiAgICAgIH1cblxuICAgICAgdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7XG4gICAgICB0aGlzLmVsLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJlbmQnLCB0aGlzLiRvdmVybGF5WzBdKTtcblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5kaXNtaXNzaWJsZSkge1xuICAgICAgICB0aGlzLl9oYW5kbGVLZXlkb3duQm91bmQgPSB0aGlzLl9oYW5kbGVLZXlkb3duLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuX2hhbmRsZUZvY3VzQm91bmQgPSB0aGlzLl9oYW5kbGVGb2N1cy5iaW5kKHRoaXMpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5faGFuZGxlS2V5ZG93bkJvdW5kKTtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9oYW5kbGVGb2N1c0JvdW5kLCB0cnVlKTtcbiAgICAgIH1cblxuICAgICAgYW5pbS5yZW1vdmUodGhpcy5lbCk7XG4gICAgICBhbmltLnJlbW92ZSh0aGlzLiRvdmVybGF5WzBdKTtcbiAgICAgIHRoaXMuX2FuaW1hdGVJbigpO1xuXG4gICAgICAvLyBGb2N1cyBtb2RhbFxuICAgICAgdGhpcy5lbC5mb2N1cygpO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbG9zZSBNb2RhbFxuICAgICAqL1xuICAgIGNsb3NlKCkge1xuICAgICAgaWYgKCF0aGlzLmlzT3Blbikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7XG4gICAgICBNb2RhbC5fbW9kYWxzT3Blbi0tO1xuXG4gICAgICAvLyBDYWxsIG9uQ2xvc2VTdGFydCBjYWxsYmFja1xuICAgICAgaWYgKHR5cGVvZih0aGlzLm9wdGlvbnMub25DbG9zZVN0YXJ0KSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aGlzLm9wdGlvbnMub25DbG9zZVN0YXJ0LmNhbGwodGhpcywgdGhpcy5lbCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZWwuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpO1xuXG4gICAgICAvLyBFbmFibGUgYm9keSBzY3JvbGxpbmcgb25seSBpZiB0aGVyZSBhcmUgbm8gbW9yZSBtb2RhbHMgb3Blbi5cbiAgICAgIGlmIChNb2RhbC5fbW9kYWxzT3BlbiA9PT0gMCkge1xuICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gJyc7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzbWlzc2libGUpIHtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX2hhbmRsZUtleWRvd25Cb3VuZCk7XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5faGFuZGxlRm9jdXNCb3VuZCk7XG4gICAgICB9XG5cbiAgICAgIGFuaW0ucmVtb3ZlKHRoaXMuZWwpO1xuICAgICAgYW5pbS5yZW1vdmUodGhpcy4kb3ZlcmxheVswXSk7XG4gICAgICB0aGlzLl9hbmltYXRlT3V0KCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyb2YgTW9kYWxcbiAgICovXG4gIE1vZGFsLl9tb2RhbHNPcGVuID0gMDtcblxuICAvKipcbiAgICogQHN0YXRpY1xuICAgKiBAbWVtYmVyb2YgTW9kYWxcbiAgICovXG4gIE1vZGFsLl9jb3VudCA9IDA7XG5cbiAgTS5Nb2RhbCA9IE1vZGFsO1xuXG4gIGlmIChNLmpRdWVyeUxvYWRlZCkge1xuICAgIE0uaW5pdGlhbGl6ZUpxdWVyeVdyYXBwZXIoTW9kYWwsICdtb2RhbCcsICdNX01vZGFsJyk7XG4gIH1cblxufSkoY2FzaCwgTS5hbmltZSk7XG4iXX0=
